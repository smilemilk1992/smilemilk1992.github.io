{"meta":{"title":"smilemilk","subtitle":"å¤§æ•°æ® Â· Python Â· æŠ€æœ¯åšå®¢","description":"good good learn, day day up!","author":"Chen Hao","url":"http://yoursite.com"},"pages":[{"title":"categories","date":"2017-11-27T15:29:11.000Z","updated":"2017-11-27T15:43:26.000Z","comments":false,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""},{"title":"about","date":"2017-11-24T07:44:33.000Z","updated":"2017-11-28T11:28:18.000Z","comments":false,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":""},{"title":"tags","date":"2017-11-27T15:01:30.000Z","updated":"2017-11-27T15:42:10.000Z","comments":false,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Javaå¤šçº¿ç¨‹ç¼–ç¨‹-synchronizedä¸ReentrantLock","slug":"Javaå¤šçº¿ç¨‹ç¼–ç¨‹-1","date":"2019-01-11T08:52:36.000Z","updated":"2019-01-11T02:39:30.599Z","comments":true,"path":"2019/01/11/Javaå¤šçº¿ç¨‹ç¼–ç¨‹-1/","link":"","permalink":"http://yoursite.com/2019/01/11/Javaå¤šçº¿ç¨‹ç¼–ç¨‹-1/","excerpt":"","text":"1ã€è¿›ç¨‹ä¸çº¿ç¨‹çš„æ¦‚å¿µï¼ˆ1ï¼‰åœ¨ä¼ ç»Ÿçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œç¨‹åºå¹¶ä¸èƒ½ç‹¬ç«‹è¿è¡Œï¼Œä½œä¸ºèµ„æºåˆ†é…å’Œç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½éƒ½æ˜¯è¿›ç¨‹ã€‚ åœ¨æœªé…ç½® OS çš„ç³»ç»Ÿä¸­ï¼Œç¨‹åºçš„æ‰§è¡Œæ–¹å¼æ˜¯é¡ºåºæ‰§è¡Œï¼Œå³å¿…é¡»åœ¨ä¸€ä¸ªç¨‹åºæ‰§è¡Œå®Œåï¼Œæ‰å…è®¸å¦ä¸€ä¸ªç¨‹åºæ‰§è¡Œï¼›åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œåˆ™å…è®¸å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œã€‚ç¨‹åºçš„è¿™ä¸¤ç§æ‰§è¡Œæ–¹å¼é—´æœ‰ç€æ˜¾è‘—çš„ä¸åŒã€‚ä¹Ÿæ­£æ˜¯ç¨‹åºå¹¶å‘æ‰§è¡Œæ—¶çš„è¿™ç§ç‰¹å¾ï¼Œæ‰å¯¼è‡´äº†åœ¨æ“ä½œç³»ç»Ÿä¸­å¼•å…¥è¿›ç¨‹çš„æ¦‚å¿µã€‚ è‡ªä»åœ¨ 20 ä¸–çºª 60 å¹´ä»£äººä»¬æå‡ºäº†è¿›ç¨‹çš„æ¦‚å¿µåï¼Œåœ¨ OS ä¸­ä¸€ç›´éƒ½æ˜¯ä»¥è¿›ç¨‹ä½œä¸ºèƒ½æ‹¥æœ‰èµ„æºå’Œç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½çš„ã€‚ç›´åˆ° 20 ä¸–çºª 80 å¹´ä»£ä¸­æœŸï¼Œäººä»¬åˆæå‡ºäº†æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½â€”â€”çº¿ç¨‹(Thread)ï¼Œè¯•å›¾ç”¨å®ƒæ¥æé«˜ç³»ç»Ÿå†…ç¨‹åºå¹¶å‘æ‰§è¡Œçš„ç¨‹åº¦ï¼Œä»è€Œå¯è¿›ä¸€æ­¥æé«˜ç³»ç»Ÿçš„ååé‡ã€‚ç‰¹åˆ«æ˜¯åœ¨è¿›å…¥ 20 ä¸–çºª 90 å¹´ä»£åï¼Œå¤šå¤„ç†æœºç³»ç»Ÿå¾—åˆ°è¿…é€Ÿå‘å±•ï¼Œçº¿ç¨‹èƒ½æ¯”è¿›ç¨‹æ›´å¥½åœ°æé«˜ç¨‹åºçš„å¹¶è¡Œæ‰§è¡Œç¨‹åº¦ï¼Œå……åˆ†åœ°å‘æŒ¥å¤šå¤„ç†æœºçš„ä¼˜è¶Šæ€§ï¼Œå› è€Œåœ¨è¿‘å‡ å¹´æ‰€æ¨å‡ºçš„å¤šå¤„ç†æœºOSä¸­ä¹Ÿéƒ½å¼•å…¥äº†çº¿ç¨‹ï¼Œä»¥æ”¹å–„OSçš„æ€§èƒ½ã€‚ â€”â€“ä»¥ä¸Šæ‘˜è‡ªã€Šè®¡ç®—æœºæ“ä½œç³»ç»Ÿ-æ±¤å°ä¸¹ç­‰ç¼–è‘—-3 ç‰ˆã€‹ ï¼ˆ2ï¼‰è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ã€‚åœ¨æ—©æœŸé¢å‘è¿›ç¨‹è®¾è®¡çš„è®¡ç®—æœºç»“æ„ä¸­ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„åŸºæœ¬æ‰§è¡Œå®ä½“ï¼›åœ¨å½“ä»£é¢å‘çº¿ç¨‹è®¾è®¡çš„è®¡ç®—æœºç»“æ„ä¸­ï¼Œè¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ã€‚ç¨‹åºæ˜¯æŒ‡ä»¤ã€æ•°æ®åŠå…¶ç»„ç»‡å½¢å¼çš„æè¿°ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„å®ä½“ã€‚ ï¼ˆ3ï¼‰çº¿ç¨‹ï¼Œæœ‰æ—¶è¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹(Lightweight Processï¼ŒLWPï¼‰ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒã€‚çº¿ç¨‹æ˜¯ç¨‹åºä¸­ä¸€ä¸ªå•ä¸€çš„é¡ºåºæ§åˆ¶æµç¨‹ã€‚è¿›ç¨‹å†…ä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„ã€å¯è°ƒåº¦çš„æ‰§è¡Œå•å…ƒï¼Œæ˜¯ç³»ç»Ÿç‹¬ç«‹è°ƒåº¦å’Œåˆ†æ´¾CPUçš„åŸºæœ¬å•ä½æŒ‡è¿è¡Œä¸­çš„ç¨‹åºçš„è°ƒåº¦å•ä½ã€‚åœ¨å•ä¸ªç¨‹åºä¸­åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹å®Œæˆä¸åŒçš„å·¥ä½œï¼Œç§°ä¸ºå¤šçº¿ç¨‹ã€‚ è¿›ç¨‹ä¸çº¿ç¨‹çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2ã€Javaå®ç°å¤šçº¿ç¨‹çš„æ–¹å¼2.1ã€ç»§æ‰¿Threadï¼Œé‡å†™runï¼ˆï¼‰æ–¹æ³•1234567891011public class MyThread extends Thread&#123; @Override public void run()&#123; System.out.println(\"çº¿ç¨‹åå­—ï¼š\"+currentThread().getName()); &#125; public static void main(String[] args) &#123; MyThread thread = new MyThread(); thread.start(); &#125;&#125; è¾“å‡ºç»“æœï¼š çº¿ç¨‹åå­—ï¼šThread-0 &ensp;&ensp;&ensp;&ensp;å¦å¤–ï¼Œè¦æ˜ç™½å¯åŠ¨çº¿ç¨‹çš„æ˜¯startï¼ˆï¼‰æ–¹æ³•è€Œä¸æ˜¯runï¼ˆï¼‰æ–¹æ³•ï¼Œå¦‚æœç”¨runï¼ˆï¼‰æ–¹æ³•ï¼Œé‚£ä¹ˆä»–å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•æ‰§è¡Œäº†ã€‚ 2.2ã€å®ç°Runableæ¥å£123456789101112public class MyRunnable implements Runnable&#123; @Override public void run()&#123; System.out.println(\"çº¿ç¨‹ä»»åŠ¡\"); &#125; public static void main(String[] args)&#123; MyRunnable myRunnable = new MyRunnable(); Thread thread = new Thread(myRunnable); thread.start(); &#125;&#125; 3ã€çº¿ç¨‹å®‰å…¨&ensp;&ensp;&ensp;&ensp;çº¿ç¨‹å®‰å…¨æ¦‚å¿µï¼šå½“å¤šä¸ªçº¿ç¨‹è®¿é—®æŸä¸€ä¸ªç±»ï¼ˆå¯¹è±¡æˆ–æ–¹æ³•ï¼‰æ—¶ï¼Œè¿™ä¸ªç±»å§‹ç»ˆèƒ½è¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºï¼Œé‚£ä¹ˆè¿™ä¸ªç±»ï¼ˆå¯¹è±¡æˆ–æ–¹æ³•ï¼‰å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ &ensp;&ensp;&ensp;&ensp;çº¿ç¨‹å®‰å…¨å°±æ˜¯å¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œé‡‡ç”¨äº†åŠ é”æœºåˆ¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥ç±»çš„æŸä¸ªæ•°æ®æ—¶ï¼Œè¿›è¡Œä¿æŠ¤ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è¿›è¡Œè®¿é—®ç›´åˆ°è¯¥çº¿ç¨‹è¯»å–å®Œï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä½¿ç”¨ã€‚ä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æˆ–è€…æ•°æ®æ±¡æŸ“ã€‚ çº¿ç¨‹ä¸å®‰å…¨å°±æ˜¯ä¸æä¾›æ•°æ®è®¿é—®ä¿æŠ¤ï¼Œæœ‰å¯èƒ½å‡ºç°å¤šä¸ªçº¿ç¨‹å…ˆåæ›´æ”¹æ•°æ®é€ æˆæ‰€å¾—åˆ°çš„æ•°æ®æ˜¯è„æ•°æ®ã€‚è¿™é‡Œçš„åŠ é”æœºåˆ¶å¸¸è§çš„å¦‚ï¼šsynchronized 3.1ã€synchronizedä¿®é¥°ç¬¦&ensp;&ensp;&ensp;&ensp; synchronizedï¼šå¯ä»¥åœ¨ä»»æ„å¯¹è±¡åŠæ–¹æ³•ä¸ŠåŠ é”ï¼Œè€ŒåŠ é”çš„è¿™æ®µä»£ç ç§°ä¸ºâ€œäº’æ–¥åŒºâ€æˆ–â€œä¸´ç•ŒåŒºâ€ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥æ¨¡æ‹Ÿç«è½¦ç«™æŠ¢ç¥¨çš„æµç¨‹ï¼šï¼ˆ1ï¼‰Runableæ¥å£åŠ é”å®ç°æ–¹æ³• 1234567891011121314151617181920212223public class MyRunnable implements Runnable&#123; private int ticket=10; ReentrantLock rt=new ReentrantLock(); //ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œæ˜¾ç¤ºåŠ é”ï¼Œæ•ˆç‡æœ€é«˜ @Override public void run()&#123; synchronized (this) &#123; //é˜²æ­¢å‡ºç°çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ ticket--; System.out.println(\"å‰©ä½™\"+ticket+\"å¼ ç¥¨\"+\" \"+Thread.currentThread()); &#125; &#125; public static void main(String[] args)&#123; System.out.println(\"=========å¼€å§‹å–ç¥¨!=========\"); MyRunnable myRunnable = new MyRunnable(); Thread thread = null; //æ¨¡æ‹Ÿ10ä¸ªäººæŠ¢ç¥¨ for(int i=0;i&lt;10;i++)&#123; thread=new Thread(myRunnable,String.valueOf(i)); thread.start(); &#125; &#125;&#125; æˆ‘ä»¬æ¨¡æ‹Ÿå¼€å¯10ä¸ªçº¿ç¨‹å¼€å§‹æŠ¢ç¥¨ï¼Œå…¶å®ç°ç»“æœï¼š12345678910å‰©ä½™9å¼ ç¥¨ Thread[0,5,main]å‰©ä½™8å¼ ç¥¨ Thread[1,5,main]å‰©ä½™7å¼ ç¥¨ Thread[2,5,main]å‰©ä½™6å¼ ç¥¨ Thread[3,5,main]å‰©ä½™5å¼ ç¥¨ Thread[4,5,main]å‰©ä½™4å¼ ç¥¨ Thread[5,5,main]å‰©ä½™3å¼ ç¥¨ Thread[6,5,main]å‰©ä½™2å¼ ç¥¨ Thread[7,5,main]å‰©ä½™1å¼ ç¥¨ Thread[8,5,main]å‰©ä½™0å¼ ç¥¨ Thread[9,5,main] æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸åŠ é”ï¼ˆsynchronizedï¼‰çš„æƒ…å†µ:12345678910å‰©ä½™8å¼ ç¥¨ Thread[1,5,main]å‰©ä½™8å¼ ç¥¨ Thread[0,5,main]å‰©ä½™7å¼ ç¥¨ Thread[2,5,main]å‰©ä½™6å¼ ç¥¨ Thread[3,5,main]å‰©ä½™5å¼ ç¥¨ Thread[4,5,main]å‰©ä½™4å¼ ç¥¨ Thread[5,5,main]å‰©ä½™3å¼ ç¥¨ Thread[6,5,main]å‰©ä½™2å¼ ç¥¨ Thread[7,5,main]å‰©ä½™1å¼ ç¥¨ Thread[8,5,main]å‰©ä½™0å¼ ç¥¨ Thread[9,5,main] é€šè¿‡ä¸Šé¢è¿è¡Œçš„ç»“æœå¯ä»¥çœ‹åˆ°ä¸åŠ é”(synchronized)çš„æ—¶å€™ï¼Œå‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ã€‚ (2)ç»§æ‰¿Threadå®ç°æ–¹æ³•(åŠ é”synchronized)1234567891011121314151617181920212223public class MyThread extends Thread&#123; public static int ticket=10; public void getTicket()&#123; synchronized (MyThread.class) &#123; //é˜²æ­¢å‡ºç°çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ ticket--; System.out.println(\"å‰©ä½™\" + ticket + \"å¼ ç¥¨\" + \" \" + currentThread().getName()); &#125; &#125; public static void main(String[] args)&#123; //å¼€10ä¸ªäººè¿›è¡ŒæŠ¢ç¥¨ for(int i=0;i&lt;10;i++)&#123; MyThread thread = new MyThread()&#123; @Override public void run()&#123; getTicket(); &#125; &#125;; thread.start(); &#125; &#125;&#125; è¯´æ˜ï¼š å½“å¤šä¸ªçº¿ç¨‹è®¿é—®MyThread çš„runæ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨äº†synchronizedä¿®é¥°ï¼Œé‚£ä¸ªå¤šçº¿ç¨‹å°±ä¼šä»¥æ’é˜Ÿçš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼ˆè¿™é‡Œæ’é˜Ÿæ˜¯æŒ‰ç…§CPUåˆ†é…çš„å…ˆåé¡ºåºè€Œå®šçš„ï¼‰ï¼Œä¸€ä¸ªçº¿ç¨‹æƒ³è¦æ‰§è¡Œsynchronizedä¿®é¥°çš„æ–¹æ³•é‡Œçš„ä»£ç ï¼Œé¦–å…ˆæ˜¯å°è¯•è·å¾—é”ï¼Œå¦‚æœæ‹¿åˆ°é”ï¼Œæ‰§è¡Œsynchronizedä»£ç ä½“çš„å†…å®¹ï¼Œå¦‚æœæ‹¿ä¸åˆ°é”çš„è¯ï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šä¸æ–­çš„å°è¯•è·å¾—è¿™æŠŠé”ï¼Œç›´åˆ°æ‹¿åˆ°ä¸ºæ­¢ï¼Œè€Œä¸”å¤šä¸ªçº¿ç¨‹åŒæ—¶å»ç«äº‰è¿™æŠŠé”ï¼Œä¹Ÿå°±æ˜¯ä¼šå‡ºç°é”ç«äº‰çš„é—®é¢˜ã€‚ 3.2ã€ReentrantLocké”çš„å®ç°æ–¹æ¡ˆ&ensp;&ensp;&ensp;&ensp;åœ¨java 5ä¹‹å‰ï¼Œä¸€ç›´é synchronizedå…³é”®å­—æ¥å®ç°é”åŠŸèƒ½çš„ï¼Œå¤„ç†å¤šçº¿ç¨‹å¹¶å‘çš„é—®é¢˜ï¼›è€Œåœ¨java 5ä¹‹åæ–°å¢äº†Lockæ¥å£æ¥å®ç°é”çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹ŸLockæ¥å£æä¾›ReentrantLockå®ç°ç±»ï¼ˆå¯é‡å…¥é”ï¼‰ã€‚ &ensp;&ensp;&ensp;&ensp;ä¸synchronizedå…³é”®å­—ç›¸æ¯”ï¼ŒReentrantLockä½¿ç”¨æ—¶éœ€è¦æ˜¾å¼çš„è·å–æˆ–é‡Šæ”¾é”ï¼Œè€Œsynchronizedå¯ä»¥éšå¼è·å–å’Œé‡Šæ”¾é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ­£å¸¸ä½¿ç”¨æƒ…å†µä¸‹ï¼ŒReentrantLockéœ€è¦æ‰‹åŠ¨æ“ä½œé”çš„è·å–å’Œé‡Šæ”¾ï¼Œsynchronizedå¯ä»¥è‡ªåŠ¨çš„è·å–å’Œé‡Šæ”¾ï¼Œä»æ“ä½œæ€§ä¸Šsynchronizedæ˜¯ç›¸å¯¹ä¾¿æ·çš„ï¼Œå±…ç„¶ReentrantLockæ˜¯æ‰‹åŠ¨çš„ï¼Œé‚£ä¹ˆä¹Ÿæœ‰å®ƒçš„ä¼˜åŠ¿ï¼Œå°±æ˜¯å¯ä»¥è‡ªå®šä¹‰ä¸€äº›å…¶ä»–çš„æ“ä½œï¼Œæ¯”å¦‚ä¸­æ–­é”çš„è·å–åŠè¶…æ—¶è·å–é”ç­‰å¤šç§ç‰¹æ€§ã€‚ ä¸‹é¢æ˜¯å…³äºLockæ¥å£ä¸€äº›ä¸»è¦æ–¹æ³•ï¼š void lock(): æ‰§è¡Œæ­¤æ–¹æ³•æ—¶ï¼Œå¦‚æœé”å¤„äºç©ºé—²çŠ¶æ€ï¼Œå½“å‰çº¿ç¨‹å°†è·å–åˆ°é”ã€‚ç›¸åï¼Œå¦‚æœé”å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œå°†ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹è·å–åˆ°é”ã€‚ boolean tryLock()ï¼š å¦‚æœé”å¯ç”¨ï¼Œåˆ™è·å–é”ï¼Œå¹¶ç«‹å³è¿”å›trueï¼Œå¦åˆ™è¿”å›false. è¯¥æ–¹æ³•å’Œlock()çš„åŒºåˆ«åœ¨äºï¼ŒtryLock()åªæ˜¯â€è¯•å›¾â€è·å–é”ï¼Œå¦‚æœé”ä¸å¯ç”¨ï¼Œä¸ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹è¢«ç¦ç”¨ï¼Œå½“å‰çº¿ç¨‹ä»ç„¶ç»§ç»­å¾€ä¸‹æ‰§è¡Œä»£ç ã€‚è€Œlock()æ–¹æ³•åˆ™æ˜¯ä¸€å®šè¦è·å–åˆ°é”ï¼Œå¦‚æœé”ä¸å¯ç”¨ï¼Œå°±ä¸€ç›´ç­‰å¾…ï¼Œåœ¨æœªè·å¾—é”ä¹‹å‰,å½“å‰çº¿ç¨‹å¹¶ä¸ç»§ç»­å‘ä¸‹æ‰§è¡Œ. é€šå¸¸é‡‡ç”¨å¦‚ä¸‹çš„ä»£ç å½¢å¼è°ƒç”¨tryLock()æ–¹æ³•ã€‚ void unlock()ï¼š æ‰§è¡Œæ­¤æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹å°†é‡Šæ”¾æŒæœ‰çš„é”. é”åªèƒ½ç”±æŒæœ‰è€…é‡Šæ”¾ï¼Œå¦‚æœçº¿ç¨‹å¹¶ä¸æŒæœ‰é”ï¼Œå´æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¯èƒ½å¯¼è‡´å¼‚å¸¸çš„å‘ç”Ÿã€‚ Condition newCondition()ï¼š æ¡ä»¶å¯¹è±¡ï¼Œè·å–ç­‰å¾…é€šçŸ¥ç»„ä»¶ã€‚è¯¥ç»„ä»¶å’Œå½“å‰çš„é”ç»‘å®šï¼Œå½“å‰çº¿ç¨‹åªæœ‰è·å–äº†é”ï¼Œæ‰èƒ½è°ƒç”¨è¯¥ç»„ä»¶çš„await()æ–¹æ³•ï¼Œè€Œè°ƒç”¨åï¼Œå½“å‰çº¿ç¨‹å°†é‡Šæ”¾é”ã€‚ ReentrantLockçš„ä½¿ç”¨å¹¶ä¸å¤æ‚ï¼Œé€šå¸¸æ˜¯åŠ é”ï¼ˆè·å–é”ï¼‰ã€é‡Šæ”¾åŒæ­¥é”å³å¯1234567891011121314151617public class ReentrantLockTest &#123; //å®šä¹‰é”å¯¹è±¡ private ReentrantLock lock=new ReentrantLock(); //å®šä¹‰éœ€è¦ä¿è¯çš„çº¿ç¨‹å®‰å…¨çš„æ–¹æ³• public void method1()&#123; //è·å–é”ï¼ŒåŠ é” lock.lock(); try &#123; //éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„ä»£ç  &#125; finally&#123; //ä½¿ç”¨finallyæ¥ä¿è¯é”çš„é‡Šæ”¾ lock.unlock(); &#125; &#125; &#125; &ensp;&ensp;&ensp;&ensp;è¿™ä¸€ç»“æ„ç¡®ä¿ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼ˆä¸´ç•ŒåŒºæ˜¯æŒ‡å…±äº«èµ„æºçš„ä»£ç åŒºï¼‰ï¼Œä¸€æ—¦ä¸€ä¸ªçº¿ç¨‹å°é”äº†é”å¯¹è±¡ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ— æ³•é€šè¿‡lockè¯­å¥ã€‚å½“å…¶ä»–çº¿ç¨‹è°ƒç”¨lockæ—¶ï¼Œå®ƒä»¬åˆ™è¢«é˜»å¡ç›´åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾é”å¯¹è±¡ã€‚æŠŠè§£é”çš„æ“ä½œæ”¾åœ¨finallyä¸­æ˜¯ååˆ†å¿…è¦çš„ï¼Œå¦‚æœåœ¨ä¸´ç•ŒåŒºå‘ç”Ÿäº†å¼‚å¸¸ï¼Œé”æ˜¯å¿…é¡»è¦é‡Šæ”¾çš„ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹å°†ä¼šæ°¸è¿œé˜»å¡ã€‚ ä½¿ç”¨ReentrantLocké”è§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ é’ˆå¯¹ä¸Šé¢ä¹°ç¥¨çš„é—®é¢˜ï¼Œä¸‹é¢å¯é‡å…¥é”ï¼ˆReentrantLockï¼‰è§£å†³: 1234567891011121314151617181920212223public class MyRunnable implements Runnable&#123; private int ticket=10; ReentrantLock rt=new ReentrantLock(); //ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œæ˜¾ç¤ºåŠ é”ï¼Œæ•ˆç‡æœ€é«˜ @Override public void run()&#123; rt.lock(); //åŠ é” ticket--; System.out.println(\"å‰©ä½™\"+ticket+\"å¼ ç¥¨\"+\" \"+Thread.currentThread()); rt.unlock(); //è§£é” &#125; public static void main(String[] args)&#123; System.out.println(\"=========å¼€å§‹å–ç¥¨!=========\"); MyRunnable myRunnable = new MyRunnable(); Thread thread = null; //å¼€10ä¸ªçº¿ç¨‹æ¶ˆè´¹æŠ¢ç¥¨ for(int i=0;i&lt;10;i++)&#123; thread=new Thread(myRunnable,String.valueOf(i)); thread.start(); &#125; &#125;&#125; æ‰“å°ç»“æœï¼š1234567891011=========å¼€å§‹å–ç¥¨!=========å‰©ä½™9å¼ ç¥¨ Thread[0,5,main]å‰©ä½™8å¼ ç¥¨ Thread[3,5,main]å‰©ä½™7å¼ ç¥¨ Thread[4,5,main]å‰©ä½™6å¼ ç¥¨ Thread[6,5,main]å‰©ä½™5å¼ ç¥¨ Thread[1,5,main]å‰©ä½™4å¼ ç¥¨ Thread[7,5,main]å‰©ä½™3å¼ ç¥¨ Thread[8,5,main]å‰©ä½™2å¼ ç¥¨ Thread[2,5,main]å‰©ä½™1å¼ ç¥¨ Thread[5,5,main]å‰©ä½™0å¼ ç¥¨ Thread[9,5,main] 4ã€synchronizedå’ŒReentrantLockçš„æ¯”è¾ƒ Lockä¸€ä¸ªæ¥å£ï¼Œæä¾›ReentrantLockå®ç°ç±»ï¼Œè€Œsynchronizedæ˜¯ä¸ªå…³é”®å­—ï¼Œæ˜¯javaå†…ç½®çº¿ç¨‹åŒæ­¥ã€‚ synchronizedåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè‡ªåŠ¨çš„é‡Šæ”¾çº¿ç¨‹å ç”¨é”å¯¹è±¡ï¼Œä¸ä¼šå¯¼è‡´æ­»é”çš„ç°è±¡å‘ç”Ÿï¼Œè€ŒLockåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨çš„é€šè¿‡unLockæ–¹æ³•é‡Šæ”¾é”å¯¹è±¡ï¼Œåˆ™å¯èƒ½ä¼šé€ æˆæ­»é”çš„å‘ç”Ÿï¼Œå› æ­¤åœ¨æ˜¯ä½¿ç”¨Lockæ—¶éœ€è¦åœ¨finallyå—ä¸­é‡Šæ”¾é”ã€‚ Lockå¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹ä¸­æ–­ï¼Œè€Œsynchronizedåˆ™ä¸è¡Œï¼Œä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œç›´åˆ°æœ‰å”¤é†’çš„æ“ä½œã€‚ Lockå¯ä»¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦æˆåŠŸè·å–é”å¯¹è±¡ï¼Œè€Œsynchronizedåˆ™ä¸è¡Œã€‚ æ€»ç»“ï¼š ReentrantLockå’Œsynchronizedç›¸æ¯”ï¼Œä¸»è¦æ˜¯ReentrantLockå®ç°ç±»å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šçš„æ–¹æ³•ï¼Œä»è€Œå†³å®šäº†ReentrantLockåœ¨åŠŸèƒ½ä¸Šæ¯”synchronizedæ›´ä¸°å¯Œäº›ã€‚ä½†ç¼ºç‚¹ä¹Ÿæ˜¯ï¼Œæ¯”å¦‚ä¸Šè¿°ç¬¬äºŒç‚¹ï¼Œå¯ä»¥åæ˜ å‡ºåœ¨ä¸€å®šç¨‹åº¦ä¸Šsynchronizedå®‰å…¨æ€§å’Œä½¿ç”¨ä¾¿æ·æ€§ä¸Šå¥½äº›ã€‚ ReentrantLockä¸­çš„ä¸€äº›æ–¹æ³•ï¼š 1234567isFair() //åˆ¤æ–­é”æ˜¯å¦æ˜¯å…¬å¹³é” isLocked() //åˆ¤æ–­é”æ˜¯å¦è¢«ä»»ä½•çº¿ç¨‹è·å–äº† isHeldByCurrentThread() //åˆ¤æ–­é”æ˜¯å¦è¢«å½“å‰çº¿ç¨‹è·å–äº† hasQueuedThreads() //åˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è¯¥é” æ€§èƒ½æ¯”è¾ƒ &ensp;&ensp;&ensp;&ensp;åœ¨æ€§èƒ½ä¸Šæ¥è¯´ï¼Œå¦‚æœç«äº‰èµ„æºä¸æ¿€çƒˆï¼Œä¸¤è€…çš„æ€§èƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œè€Œ å½“ç«äº‰èµ„æºéå¸¸æ¿€çƒˆæ—¶ï¼ˆå³æœ‰å¤§é‡çº¿ç¨‹åŒæ—¶ç«äº‰ï¼‰ï¼Œæ­¤æ—¶ReentrantLockçš„æ€§èƒ½è¦è¿œè¿œä¼˜äºsynchronized ã€‚æ‰€ä»¥è¯´ï¼Œåœ¨å…·ä½“ä½¿ç”¨æ—¶è¦æ ¹æ®é€‚å½“æƒ…å†µé€‰æ‹©ã€‚ &ensp;&ensp;&ensp;&ensp;åœ¨JDK1.5ä¸­ï¼Œsynchronizedæ˜¯æ€§èƒ½ä½æ•ˆçš„ã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªé‡é‡çº§æ“ä½œï¼Œå®ƒå¯¹æ€§èƒ½æœ€å¤§çš„å½±å“æ˜¯é˜»å¡çš„æ˜¯å®ç°ï¼ŒæŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹çš„æ“ä½œéƒ½éœ€è¦è½¬å…¥å†…æ ¸æ€ä¸­å®Œæˆï¼Œè¿™äº›æ“ä½œç»™ç³»ç»Ÿçš„å¹¶å‘æ€§å¸¦æ¥äº†å¾ˆå¤§çš„å‹åŠ›ã€‚ç›¸æ¯”ä¹‹ä¸‹ä½¿ç”¨Javaæä¾›çš„ReentrankLockå¯¹è±¡ï¼Œæ€§èƒ½æ›´é«˜ä¸€äº›ã€‚åˆ°äº†JDK1.6ï¼Œå‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¹synchronizeåŠ å…¥äº†å¾ˆå¤šä¼˜åŒ–æªæ–½ï¼Œæœ‰è‡ªé€‚åº”è‡ªæ—‹ï¼Œé”æ¶ˆé™¤ï¼Œé”ç²—åŒ–ï¼Œè½»é‡çº§é”ï¼Œåå‘é”ç­‰ç­‰ã€‚å¯¼è‡´åœ¨JDK1.6ä¸Šsynchronizeçš„æ€§èƒ½å¹¶ä¸æ¯”Lockå·®ã€‚å®˜æ–¹ä¹Ÿè¡¨ç¤ºï¼Œä»–ä»¬ä¹Ÿæ›´æ”¯æŒsynchronizeï¼Œåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¿˜æœ‰ä¼˜åŒ–ä½™åœ°ï¼Œ æ‰€ä»¥è¿˜æ˜¯æå€¡åœ¨synchronizedèƒ½å®ç°éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨synchronizedæ¥è¿›è¡ŒåŒæ­¥ ã€‚","categories":[{"name":"java","slug":"java","permalink":"http://yoursite.com/categories/java/"}],"tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://yoursite.com/tags/å¤šçº¿ç¨‹/"},{"name":"Synchronized","slug":"Synchronized","permalink":"http://yoursite.com/tags/Synchronized/"}],"keywords":[{"name":"java","slug":"java","permalink":"http://yoursite.com/categories/java/"}]},{"title":"æ…Œå¾—ä¸€åŒ¹ï¼æ•™å¤§å®¶å¦‚ä½•åº”å¯¹åœ¨çº¿æ•…éšœï¼","slug":"æ…Œå¾—ä¸€åŒ¹ï¼æ•™å¤§å®¶å¦‚ä½•åº”å¯¹åœ¨çº¿æ•…éšœï¼","date":"2019-01-10T06:09:51.000Z","updated":"2019-01-10T06:24:04.843Z","comments":true,"path":"2019/01/10/æ…Œå¾—ä¸€åŒ¹ï¼æ•™å¤§å®¶å¦‚ä½•åº”å¯¹åœ¨çº¿æ•…éšœï¼/","link":"","permalink":"http://yoursite.com/2019/01/10/æ…Œå¾—ä¸€åŒ¹ï¼æ•™å¤§å®¶å¦‚ä½•åº”å¯¹åœ¨çº¿æ•…éšœï¼/","excerpt":"","text":"çº¿ä¸Šè¿è¡Œçš„Javaåº”ç”¨çªç„¶æ²¡æœ‰å“åº”ã€å“åº”ç¼“æ…¢ï¼Œè¿›ç¨‹çªç„¶æ¶ˆå¤±ï¼Œé‡åˆ°è¿™äº›æƒ…å†µåº”è¯¥å¦‚ä½•åº”å¯¹å‘¢ï¼Ÿ æ¥è‡ªå…¬å¸å†…éƒ¨åˆ†äº«","categories":[{"name":"java","slug":"java","permalink":"http://yoursite.com/categories/java/"}],"tags":[{"name":"bugä¿®å¤","slug":"bugä¿®å¤","permalink":"http://yoursite.com/tags/bugä¿®å¤/"}],"keywords":[{"name":"java","slug":"java","permalink":"http://yoursite.com/categories/java/"}]},{"title":"javaåˆ†å¸ƒå¼é”ä¹‹rediså®ç°ç¯‡","slug":"javaåˆ†å¸ƒå¼é”","date":"2019-01-09T08:03:11.000Z","updated":"2019-01-11T02:36:32.319Z","comments":true,"path":"2019/01/09/javaåˆ†å¸ƒå¼é”/","link":"","permalink":"http://yoursite.com/2019/01/09/javaåˆ†å¸ƒå¼é”/","excerpt":"","text":"&ensp;&ensp;&ensp;&ensp;åˆšå¼€å§‹å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å…¶å®æˆ‘æ˜¯æ‹’ç»çš„ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯æœ€è¿‘æ‰æ¥è§¦è¿™æ–¹é¢çš„çŸ¥è¯†ç‚¹ï¼Œå®ç°æŠ€æœ¯æœ¬èº«ä¹Ÿæ˜¯é›•è™«å°æŠ€ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯è§‰å¾—æ‹¿å‡ºæ¥ä¸å¤§å®¶ä¸€èµ·åˆ†äº«ï¼Œæœ¬ç€ä¸€ä¸ªå­¦ä¹ çš„æ€åº¦å§ï¼Œå¦‚æœæœ‰å¤§ä½¬çœ‹åˆ°ï¼Œè¯·æŒ‡ç‚¹ä¸€äºŒå“ˆï¼ 1ã€å‰è¨€&ensp;&ensp;&ensp;&ensp;ç”±äºåœ¨å¹³æ—¶çš„å·¥ä½œä¸­ï¼Œçº¿ä¸ŠæœåŠ¡å™¨æ˜¯åˆ†å¸ƒå¼å¤šå°éƒ¨ç½²çš„ï¼Œç»å¸¸ä¼šé¢ä¸´è§£å†³åˆ†å¸ƒå¼åœºæ™¯ä¸‹æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œé‚£ä¹ˆå°±è¦åˆ©ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚æ‰€ä»¥å°†è‡ªå·±çš„å¿ƒå¾—ä½“ä¼šè®°å½•ä¸‹æ¥åšä¸€ä¸ªè®²è§£å’Œæ€»ç»“ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯ä»¥æ–¹ä¾¿è‡ªå·±ä»¥åæŸ¥é˜…ï¼ŒåŒæ—¶è¦æ˜¯èƒ½å¸®åŠ©åˆ°åˆšå¼€å§‹æ¥è§¦åˆ°è¿™æ–¹é¢çš„åŒå­¦é‚£ä¹Ÿæ˜¯å¾ˆå¥½çš„ã€‚ 2ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åˆ†å¸ƒå¼é”&ensp;&ensp;&ensp;&ensp;å…³äºåˆ†å¸ƒå¼é”ï¼Œå¯èƒ½ç»å¤§éƒ¨åˆ†äººéƒ½ä¼šæˆ–å¤šæˆ–å°‘æ¶‰åŠåˆ°ã€‚ æˆ‘ä¸¾äºŒä¸ªä¾‹å­ï¼šåœºæ™¯ä¸€ï¼šä»å‰ç«¯ç•Œé¢å‘èµ·ä¸€ç¬”æ”¯ä»˜è¯·æ±‚ï¼Œå¦‚æœå‰ç«¯æ²¡æœ‰åšé˜²é‡å¤„ç†ï¼Œé‚£ä¹ˆå¯èƒ½åœ¨æŸä¸€ä¸ªæ—¶åˆ»ä¼šæœ‰äºŒç¬”ä¸€æ ·çš„å•å­åŒæ—¶åˆ°è¾¾ç³»ç»Ÿåå°ã€‚åœºæ™¯äºŒï¼šåœ¨Appä¸­ä¸‹è®¢å•çš„æ—¶å€™ï¼Œç‚¹å‡»ç¡®è®¤ä¹‹åï¼Œæ²¡ååº”ï¼Œå°±åˆç‚¹å‡»äº†å‡ æ¬¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ— æ³•ä¿è¯è¯¥æ¥å£çš„å¹‚ç­‰æ€§ï¼Œé‚£ä¹ˆå°†ä¼šå‡ºç°é‡å¤ä¸‹å•é—®é¢˜ã€‚ åœ¨æ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ¶ˆæ¯æ¨é€é‡å¤ã€‚å¦‚æœå¤„ç†æ¶ˆæ¯çš„æ¥å£æ— æ³•ä¿è¯å¹‚ç­‰ï¼Œé‚£ä¹ˆé‡å¤æ¶ˆè´¹æ¶ˆæ¯äº§ç”Ÿçš„å½±å“å¯èƒ½ä¼šéå¸¸å¤§ã€‚ &ensp;&ensp;&ensp;&ensp;ä¸ºäº†ä¿è¯ä¸€ä¸ªæ–¹æ³•æˆ–å±æ€§åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹çš„åŒä¸€æ—¶é—´åªèƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œåœ¨ä¼ ç»Ÿå•ä½“åº”ç”¨å•æœºéƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Javaå¹¶å‘å¤„ç†ç›¸å…³çš„API(å¦‚ReentrantLockæˆ–Synchronized)è¿›è¡Œäº’æ–¥æ§åˆ¶ã€‚åœ¨å•æœºç¯å¢ƒä¸­ï¼ŒJavaä¸­æä¾›äº†å¾ˆå¤šå¹¶å‘å¤„ç†ç›¸å…³çš„APIã€‚ä½†æ˜¯ï¼Œéšç€ä¸šåŠ¡å‘å±•çš„éœ€è¦ï¼ŒåŸå•ä½“å•æœºéƒ¨ç½²çš„ç³»ç»Ÿè¢«æ¼”åŒ–æˆåˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿåï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆï¼Œå•çº¯çš„Java APIå¹¶ä¸èƒ½æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦ä¸€ç§è·¨JVMçš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”è¦è§£å†³çš„é—®é¢˜ï¼ 3ã€åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡çš„æ¡ä»¶123456åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªæœºå™¨çš„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼›é«˜å¯ç”¨çš„è·å–é”ä¸é‡Šæ”¾é”ï¼›é«˜æ€§èƒ½çš„è·å–é”ä¸é‡Šæ”¾é”ï¼›å…·å¤‡å¯é‡å…¥ç‰¹æ€§ï¼›å…·å¤‡é”å¤±æ•ˆæœºåˆ¶ï¼Œé˜²æ­¢æ­»é”ï¼›å…·å¤‡éé˜»å¡é”ç‰¹æ€§ï¼Œå³æ²¡æœ‰è·å–åˆ°é”å°†ç›´æ¥è¿”å›è·å–é”å¤±è´¥ã€‚ 4ã€åŸºäºredisçš„å®ç°æ–¹å¼4.1ã€é€‰æ‹©rediså®ç°åˆ†å¸ƒå¼é”çš„åŸå›  Redisæœ‰å¾ˆé«˜çš„æ€§èƒ½ Rediså‘½ä»¤å¯¹æ­¤æ”¯æŒè¾ƒå¥½ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ 4.2ã€ä½¿ç”¨å‘½ä»¤ä»‹ç»ï¼ˆ1ï¼‰SETNXï¼šSETNX key valï¼šå½“ä¸”ä»…å½“keyä¸å­˜åœ¨æ—¶ï¼Œsetä¸€ä¸ªkeyä¸ºvalçš„å­—ç¬¦ä¸²ï¼Œè¿”å›1ï¼›è‹¥keyå­˜åœ¨ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å›0ã€‚ ï¼ˆ2ï¼‰expireï¼šexpire key timeoutï¼šä¸ºkeyè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºsecondï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…æ­»é”ã€‚ ï¼ˆ3ï¼‰deleteï¼šdelete keyï¼šåˆ é™¤key åœ¨ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”çš„æ—¶å€™ï¼Œä¸»è¦å°±ä¼šä½¿ç”¨åˆ°è¿™ä¸‰ä¸ªå‘½ä»¤ã€‚ 4.3ã€å®ç°æ€æƒ³ï¼ˆ1ï¼‰è·å–é”çš„æ—¶å€™ï¼Œä½¿ç”¨setnxåŠ é”ï¼Œå¹¶ä½¿ç”¨expireå‘½ä»¤ä¸ºé”æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´åˆ™è‡ªåŠ¨é‡Šæ”¾é”ï¼Œé”çš„valueå€¼ä¸ºä¸€ä¸ªéšæœºç”Ÿæˆçš„UUIDï¼Œé€šè¿‡æ­¤åœ¨é‡Šæ”¾é”çš„æ—¶å€™è¿›è¡Œåˆ¤æ–­ã€‚ ï¼ˆ2ï¼‰è·å–é”çš„æ—¶å€™è¿˜è®¾ç½®ä¸€ä¸ªè·å–çš„è¶…æ—¶æ—¶é—´ï¼Œè‹¥è¶…è¿‡è¿™ä¸ªæ—¶é—´åˆ™æ”¾å¼ƒè·å–é”ã€‚ ï¼ˆ3ï¼‰é‡Šæ”¾é”çš„æ—¶å€™ï¼Œé€šè¿‡UUIDåˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥é”ï¼Œè‹¥æ˜¯è¯¥é”ï¼Œåˆ™æ‰§è¡Œdeleteè¿›è¡Œé”é‡Šæ”¾ã€‚ 4.4ã€å…·ä½“å®ç°æµç¨‹å…³äºredisåˆ†å¸ƒå¼é”çš„å®ç°æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ³¨æ„ï¼šå•ä¸ªçº¿ç¨‹ä»»åŠ¡å¤„ç†æ—¶é—´threadTimeã€è·å–é”çš„ç­‰å¾…æ—¶é—´acquireTimeoutã€é”çš„è¿‡æœŸæ—¶é—´timeoutä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼š 1ã€threadTime &lt; timeout ï¼ˆä¸ç„¶ä¼šå‡ºé”™ï¼‰ 2ã€acquireTimeout &lt; threadTime &lt; timeout (ä¸€èˆ¬æ ‡å‡†çš„è®¾ç½®æ—¶é—´æ–¹æ³•) åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ï¼š TestRedisLockç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657public class TestRedisLock &#123; //redisåˆ†å¸ƒå¼é” public static void lock()&#123; String indentifier = null; RedisLock redisLock = null; try &#123; //toDO å¢åŠ åˆ†å¸ƒå¼é”é€»è¾‘ redisLock = new RedisLock(RedisClient.jedisSentinelPool); //é¦–æ¬¡è·å–åˆ°é”æ˜¯å¿…ç„¶çš„ acquireTimeout ä¸ºè·å–é”çš„ç­‰å¾…æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡æ­¤æ—¶é—´å°±æ”¾å¼ƒ timeout ä¸ºé”çš„è¿‡æœŸæ—¶é—´ indentifier = redisLock.lockWithTimeout(\"ss_test\",3500, 3000); System.out.println(Thread.currentThread()+\"å°è¯•è·å–é”,indentifier:\"+indentifier); ThreadLocal&lt;AtomicInteger&gt; threadLocal = new ThreadLocal(); threadLocal.set(new AtomicInteger(0)); while (indentifier == null)&#123;//ä¸€ç›´è¯·æ±‚é”ï¼Œç›´åˆ°æ‹¿åˆ°ä¸ºæ­¢ threadLocal.get().getAndIncrement(); indentifier = redisLock.lockWithTimeout(\"ss_test\",3500, 3000); //Thread.currentThread().sleep(100); System.out.println(Thread.currentThread()+\"å°è¯•è·å–é”,indentifier:\"+indentifier+\"ï¼Œç¬¬\"+threadLocal.get().get()+\"æ¬¡\"); &#125; if(indentifier!=null)&#123; //æ‹¿åˆ°é”å¼€å§‹å¹²æ´» System.out.println(Thread.currentThread()+\"è·å–åˆ°é”,indentifier:\"+indentifier); Thread.currentThread().sleep(4000); //System.out.println(1/0); //todo æ‰§è¡Œä»»åŠ¡ System.out.println(Thread.currentThread()+\"æ‰§è¡Œå®Œæˆ\"); &#125;else &#123; System.out.println(Thread.currentThread()+\"æ²¡æœ‰è·å–åˆ°é”\"); &#125; &#125; catch(Exception ex)&#123; ex.printStackTrace(); &#125; finally &#123; if(redisLock!=null &amp;&amp; StringUtils.isNotEmpty(indentifier))&#123; redisLock.releaseLock(\"ss_test\",indentifier); System.out.println(Thread.currentThread()+\"é‡Šæ”¾é”\"); &#125; &#125; &#125; //todo çº¿ç¨‹é” public static void main(String[] args) &#123; //æ¨¡æ‹Ÿ100äººæŠ¢è´­ for (int i=0;i&lt;5;i++)&#123; Thread thread = new Thread()&#123; @Override public void run()&#123; lock(); &#125; &#125;; thread.start(); &#125; &#125;&#125; RedisLockç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109public class RedisLock &#123; private final JedisPool jedisPool; private static final Logger logger = Logger.getLogger(RedisLock.class); public RedisLock(JedisPool jedisPool) &#123; this.jedisPool = jedisPool; &#125; /** * * @param locaName é”çš„key * @param acquireTimeout å°è¯•è·å–é”è¶…æ—¶æ—¶é—´ * @param timeout keyçš„è¶…æ—¶æ—¶é—´ * @return é”æ ‡è¯† */ public String lockWithTimeout(String locaName, long acquireTimeout, long timeout) &#123; Jedis conn = null; String retIdentifier = null; try &#123; // è·å–è¿æ¥ // éšæœºç”Ÿæˆä¸€ä¸ªvalue String identifier = UUID.randomUUID().toString(); //å¦‚æœidentifierå­˜åœ¨åˆ™æˆåŠŸè·å–åˆ°é”ï¼Œå¦åˆ™è¡¨æ˜è¯¥é”å·²ç»è¢«å…¶ä»–çº¿ç¨‹å ç”¨ // é”åï¼Œå³keyå€¼ String lockKey = \"lock:\" + locaName; // è¶…æ—¶æ—¶é—´ï¼Œä¸Šé”åè¶…è¿‡æ­¤æ—¶é—´åˆ™è‡ªåŠ¨é‡Šæ”¾é” int lockExpire = (int)(timeout / 1000); conn = jedisPool.getResource(); // è·å–é”çš„è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´åˆ™æ”¾å¼ƒè·å–é” long end = System.currentTimeMillis() + acquireTimeout; while (System.currentTimeMillis() &lt; end) &#123; //Jedis conn = jedisPool.getResource(); //System.out.println(\"ç­‰å¾…æ—¶é—´:\"+System.currentTimeMillis()); if (conn.setnx(lockKey, identifier) == 1) &#123; conn.expire(lockKey, lockExpire); // è¿”å›valueå€¼ï¼Œç”¨äºé‡Šæ”¾é”æ—¶é—´ç¡®è®¤ retIdentifier = identifier; /*if (conn != null) &#123; conn.close(); //System.out.println(\"å…³é—­è¿æ¥\"); &#125;*/ return retIdentifier; &#125; // è¿”å›-1ä»£è¡¨keyæ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¸ºkeyè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ if (conn.ttl(lockKey) == -1) &#123; conn.expire(lockKey, lockExpire); &#125; try &#123; Thread.sleep(10); &#125; catch (InterruptedException e) &#123; Thread.currentThread().interrupt(); logger.error(\"RedisLockä¸­æ–­å¼‚å¸¸\",e); &#125; /* if (conn != null) &#123; conn.close(); //System.out.println(\"å…³é—­è¿æ¥\"); &#125;*/ &#125; &#125; catch (JedisException e) &#123; logger.error(\"RedisLockè·å–é”å¼‚å¸¸\",e); //jedisPool.returnBrokenResource(conn); &#125; finally &#123; if (conn != null) &#123; conn.close(); // System.out.println(\"å…³é—­è¿æ¥\"); &#125; &#125; return retIdentifier; &#125; /** * é‡Šæ”¾é” * @param lockName é”çš„key * @param identifier é‡Šæ”¾é”çš„æ ‡è¯† * @return */ public boolean releaseLock(String lockName, String identifier) &#123; Jedis conn = null; String lockKey = \"lock:\" + lockName; boolean retFlag = false; try &#123; conn = jedisPool.getResource(); while (true) &#123; // ç›‘è§†lockï¼Œå‡†å¤‡å¼€å§‹äº‹åŠ¡ conn.watch(lockKey); // é€šè¿‡å‰é¢è¿”å›çš„valueå€¼åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥é”ï¼Œè‹¥æ˜¯è¯¥é”ï¼Œåˆ™åˆ é™¤ï¼Œé‡Šæ”¾é” if (identifier.equals(conn.get(lockKey))) &#123; Transaction transaction = conn.multi(); transaction.del(lockKey); List&lt;Object&gt; results = transaction.exec(); if (results == null) &#123; continue; &#125; retFlag = true; &#125; conn.unwatch(); break; &#125; &#125; catch (JedisException e) &#123; logger.error(\"RedisLocké‡Šæ”¾é”å¼‚å¸¸\",e); &#125; finally &#123; if (conn != null) &#123; conn.close(); &#125; &#125; return retFlag; &#125;&#125; æœ¬æ¬¡æµ‹è¯•æ¨¡æ‹Ÿäº”ä¸ªçº¿ç¨‹ï¼ŒacquireTimeout = 2500ï¼Œ threadTime = 2700 ï¼Œ timeout = 3000 å®éªŒç»“æœå¦‚ä¸‹ï¼š 5ã€å°ç»“&ensp;&ensp;&ensp;&ensp;åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå¯¹èµ„æºè¿›è¡Œä¸Šé”æœ‰æ—¶å€™æ˜¯å¾ˆé‡è¦çš„ï¼Œæ¯”å¦‚æŠ¢è´­æŸä¸€èµ„æºï¼Œè¿™æ—¶å€™ä½¿ç”¨åˆ†å¸ƒå¼é”å°±å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶èµ„æºã€‚ å½“ç„¶ï¼Œåœ¨å…·ä½“ä½¿ç”¨ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘å¾ˆå¤šå› ç´ ï¼Œæ¯”å¦‚è¶…æ—¶æ—¶é—´çš„é€‰å–ï¼Œè·å–é”æ—¶é—´çš„é€‰å–å¯¹å¹¶å‘é‡éƒ½æœ‰å¾ˆå¤§çš„å½±å“ï¼Œä¸Šè¿°å®ç°çš„åˆ†å¸ƒå¼é”ä¹Ÿåªæ˜¯ä¸€ç§ç®€å•çš„å®ç°ï¼Œä¸»è¦æ˜¯ä¸€ç§æ€æƒ³ï¼Œä»¥ä¸ŠåŒ…æ‹¬æ–‡ä¸­çš„ä»£ç å¯èƒ½å¹¶ä¸é€‚ç”¨äºæ­£å¼çš„ç”Ÿäº§ç¯å¢ƒï¼Œåªåšå…¥é—¨å‚è€ƒï¼","categories":[{"name":"java","slug":"java","permalink":"http://yoursite.com/categories/java/"}],"tags":[{"name":"åˆ†å¸ƒå¼é”","slug":"åˆ†å¸ƒå¼é”","permalink":"http://yoursite.com/tags/åˆ†å¸ƒå¼é”/"},{"name":"redis","slug":"redis","permalink":"http://yoursite.com/tags/redis/"}],"keywords":[{"name":"java","slug":"java","permalink":"http://yoursite.com/categories/java/"}]},{"title":"ã€æ·±åº¦å¥½æ–‡ã€‘simhashæ–‡æœ¬å»é‡æµç¨‹","slug":"simhash","date":"2019-01-06T12:37:41.000Z","updated":"2019-01-10T05:52:50.672Z","comments":true,"path":"2019/01/06/simhash/","link":"","permalink":"http://yoursite.com/2019/01/06/simhash/","excerpt":"","text":"&ensp;&ensp;&ensp;&ensp;æœ¬äººç›®å‰å°±èŒäºæŸå‚æ–°é—»å®¢æˆ·ç«¯ï¼Œå¯¹äºæ–°é—»å®¢æˆ·ç«¯è€Œè¨€ï¼Œæ¨èçš„æ¯ä¸€åˆ·çš„æ–°é—»éƒ½å¿…é¡»æ˜¯ä¸åŒçš„æ–°é—»ï¼Œè¿™å°±éœ€è¦å¯¹æ–°é—»æ–‡æœ¬è¿›è¡Œæ’é‡ã€‚ä¼ ç»Ÿçš„å»é‡ä¸€èˆ¬æ˜¯å¯¹æ–‡ç« çš„urlé“¾æ¥è¿›è¡Œæ’é‡ï¼Œä½†æ˜¯å¯¹äºæŠ“å–çš„ç½‘é¡µæ¥è¯´ï¼Œå„å¤§å¹³å°çš„æ–°é—»å¯èƒ½å­˜åœ¨é‡å¤ï¼Œå¯¹äºåªé€šè¿‡æ–‡ç« urlè¿›è¡Œæ’é‡æ˜¯ä¸é è°±çš„ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªç—›ç‚¹äºæ˜¯å°±æå‡ºäº†ç”¨simhashæ¥è§£å†³è¿™ä¸ªéš¾é¢˜ã€‚ 1.ç®€ä»‹&ensp;&ensp;&ensp;&ensp;ä¼ ç»Ÿçš„Hashç®—æ³•åªè´Ÿè´£å°†åŸå§‹å†…å®¹å°½é‡å‡åŒ€éšæœºåœ°æ˜ å°„ä¸ºä¸€ä¸ªç­¾åå€¼ï¼ŒåŸç†ä¸Šä»…ç›¸å½“äºä¼ªéšæœºæ•°äº§ç”Ÿç®—æ³•ã€‚å³ä¾¿æ˜¯ä¸¤ä¸ªåŸå§‹å†…å®¹åªç›¸å·®ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€äº§ç”Ÿçš„ç­¾åä¹Ÿå¾ˆå¯èƒ½å·®åˆ«å¾ˆå¤§ï¼Œæ‰€ä»¥ä¼ ç»Ÿçš„Hashæ˜¯æ— æ³•åœ¨ç­¾åçš„ç»´åº¦ä¸Šæ¥è¡¡é‡åŸå†…å®¹çš„ç›¸ä¼¼åº¦ã€‚è€ŒSimHashæœ¬èº«å±äºä¸€ç§å±€éƒ¨æ•æ„Ÿhashï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯é™ç»´ï¼Œå°†é«˜ç»´çš„ç‰¹å¾å‘é‡è½¬åŒ–æˆä¸€ä¸ªfä½çš„æŒ‡çº¹ï¼ˆfingerprintï¼‰ï¼Œé€šè¿‡ç®—å‡ºä¸¤ä¸ªæŒ‡çº¹çš„æµ·æ˜è·ç¦»ï¼ˆhamming distinceï¼‰æ¥ç¡®å®šä¸¤ç¯‡æ–‡ç« çš„ç›¸ä¼¼åº¦ï¼Œæµ·æ˜è·ç¦»è¶Šå°ï¼Œç›¸ä¼¼åº¦è¶Šä½ï¼ˆæ ¹æ® Detecting Near-Duplicates for Web Crawling è®ºæ–‡ä¸­æ‰€è¯´ï¼‰ï¼Œä¸€èˆ¬æµ·æ˜è·ç¦»ä¸º3å°±ä»£è¡¨ä¸¤ç¯‡æ–‡ç« ç›¸åŒã€‚&ensp;&ensp;&ensp;&ensp;simhashä¹Ÿæœ‰å…¶å±€é™æ€§ï¼Œåœ¨å¤„ç†å°äº500å­—çš„çŸ­æ–‡æœ¬æ—¶ï¼Œsimhashçš„è¡¨ç°å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨simhashå‰ä¸€å®šè¦æ³¨æ„è¿™ä¸ªç»†èŠ‚ã€‚ 2.èƒŒæ™¯ å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ¯”è¾ƒä¸¤ç¯‡æ–‡ç« ç›¸ä¼¼åº¦çš„ç®—æ³•ï¼Ÿå¯èƒ½ä½ ä¼šå›ç­”å‡ ä¸ªæ¯”è¾ƒä¼ ç»Ÿç‚¹çš„æ€è·¯: ä¸€ç§æ–¹æ¡ˆæ˜¯å…ˆå°†ä¸¤ç¯‡æ–‡ç« åˆ†åˆ«è¿›è¡Œåˆ†è¯ï¼Œå¾—åˆ°ä¸€ç³»åˆ—ç‰¹å¾å‘é‡ï¼Œç„¶åè®¡ç®—ç‰¹å¾å‘é‡ä¹‹é—´çš„è·ç¦»ï¼ˆå¯ä»¥è®¡ç®—å®ƒä»¬ä¹‹é—´çš„æ¬§æ°è·ç¦»ã€æµ·æ˜è·ç¦»æˆ–è€…å¤¹è§’ä½™å¼¦ç­‰ç­‰ï¼‰ï¼Œä»è€Œé€šè¿‡è·ç¦»çš„å¤§å°æ¥åˆ¤æ–­ä¸¤ç¯‡æ–‡ç« çš„ç›¸ä¼¼åº¦ã€‚ å¦å¤–ä¸€ç§æ˜¯ä¼ ç»Ÿhashï¼Œæˆ‘ä»¬è€ƒè™‘ä¸ºæ¯ä¸€ä¸ªwebæ–‡æ¡£é€šè¿‡hashçš„æ–¹å¼ç”Ÿæˆä¸€ä¸ªæŒ‡çº¹ï¼ˆfinger printï¼‰ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸¤ç§æ–¹æ³•: é‡‡å–ç¬¬ä¸€ç§æ–¹æ³•ï¼Œè‹¥æ˜¯åªæ¯”è¾ƒä¸¤ç¯‡æ–‡ç« çš„ç›¸ä¼¼æ€§è¿˜å¥½ï¼Œä½†å¦‚æœæ˜¯æµ·é‡æ•°æ®å‘¢ï¼Œæœ‰ç€æ•°ä»¥ç™¾ä¸‡ç”šè‡³äº¿ä¸‡çš„ç½‘é¡µï¼Œè¦æ±‚ä½ è®¡ç®—è¿™äº›ç½‘é¡µçš„ç›¸ä¼¼åº¦ã€‚ä½ è¿˜ä¼šå»è®¡ç®—ä»»æ„ä¸¤ä¸ªç½‘é¡µä¹‹é—´çš„è·ç¦»æˆ–å¤¹è§’ä½™å¼¦ä¹ˆï¼Ÿé‚£æ ·åšçš„è¯æ—¶é—´å¤æ‚åº¦ï¼Œç©ºé—´å¤æ‚åº¦å¯æƒ³è€ŒçŸ¥ã€‚ è€Œç¬¬äºŒç§æ–¹æ¡ˆä¸­æ‰€è¯´çš„ä¼ ç»ŸåŠ å¯†æ–¹å¼md5ï¼Œå…¶è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†è®©æ•´ä¸ªåˆ†å¸ƒå°½å¯èƒ½åœ°å‡åŒ€ï¼Œä½†å¦‚æœè¾“å…¥å†…å®¹ä¸€æ—¦å‡ºç°å“ªæ€•è½»å¾®çš„å˜åŒ–ï¼Œhashå€¼å°±ä¼šå‘ç”Ÿå¾ˆå¤§çš„å˜åŒ–ã€‚ 3.simhashä¸hashç®—æ³•çš„åŒºåˆ«&ensp;&ensp;&ensp;&ensp;ä¼ ç»ŸHashç®—æ³•åªè´Ÿè´£å°†åŸå§‹å†…å®¹å°½é‡å‡åŒ€éšæœºåœ°æ˜ å°„ä¸ºä¸€ä¸ªç­¾åå€¼ï¼ŒåŸç†ä¸Šä»…ç›¸å½“äºä¼ªéšæœºæ•°äº§ç”Ÿç®—æ³•ã€‚ä¼ ç»Ÿhashç®—æ³•äº§ç”Ÿçš„ä¸¤ä¸ªç­¾åï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œé™¤äº†è¯´æ˜åŸå§‹å†…å®¹ä¸ç›¸ç­‰å¤–ï¼Œä¸å†æä¾›ä»»ä½•ä¿¡æ¯ï¼Œå› ä¸ºå³ä½¿åŸå§‹å†…å®¹åªç›¸å·®ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€äº§ç”Ÿçš„ç­¾åä¹Ÿå¾ˆå¯èƒ½å·®åˆ«å¾ˆå¤§ï¼Œæ‰€ä»¥ä¼ ç»ŸHashæ˜¯æ— æ³•åœ¨ç­¾åçš„ç»´åº¦ä¸Šæ¥è¡¡é‡åŸå†…å®¹çš„ç›¸ä¼¼åº¦ã€‚è€ŒSimHashæœ¬èº«å±äºä¸€ç§å±€éƒ¨æ•æ„Ÿå“ˆå¸Œç®—æ³•ï¼Œå®ƒäº§ç”Ÿçš„hashç­¾ååœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è¡¨å¾åŸå†…å®¹çš„ç›¸ä¼¼åº¦ã€‚&ensp;&ensp;&ensp;&ensp;æˆ‘ä»¬ä¸»è¦è§£å†³çš„æ˜¯æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—ï¼Œè¦æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªæ–‡ç« æ˜¯å¦ç›¸ä¼¼ï¼Œå½“ç„¶æˆ‘ä»¬é™ç»´ç”Ÿæˆäº†hashç­¾åä¹Ÿæ˜¯ç”¨äºè¿™ä¸ªç›®çš„ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä¼°è®¡å¤§å®¶å°±æ˜ç™½äº†ï¼Œå³ä½¿æŠŠæ–‡ç« ä¸­çš„å­—ç¬¦ä¸²å˜æˆ 01 ä¸²ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„simhashç®—æ³•ä¹Ÿè¿˜æ˜¯å¯ä»¥ç”¨äºè®¡ç®—ç›¸ä¼¼åº¦ï¼Œè€Œä¼ ç»Ÿçš„hashå´ä¸è¡Œã€‚æˆ‘ä»¬å¯ä»¥æ¥åšä¸ªæµ‹è¯•ï¼Œä¸¤ä¸ªç›¸å·®åªæœ‰ä¸€ä¸ªå­—ç¬¦çš„æ–‡æœ¬ä¸²ï¼Œâ€œä½ å¦ˆå¦ˆå–Šä½ å›å®¶åƒé¥­å“¦ï¼Œå›å®¶ç½—å›å®¶ç½—â€ å’Œ â€œä½ å¦ˆå¦ˆå«ä½ å›å®¶åƒé¥­å•¦ï¼Œå›å®¶ç½—å›å®¶ç½—â€ã€‚ 4.simhashåŸç† simhashæ˜¯googleç”¨æ¥å¤„ç†æµ·é‡æ–‡æœ¬å»é‡çš„ç®—æ³•ã€‚ googleå‡ºå“ï¼Œä½ æ‡‚çš„ã€‚ simhashæœ€ç‰›é€¼çš„ä¸€ç‚¹å°±æ˜¯å°†ä¸€ä¸ªæ–‡æ¡£ï¼Œæœ€åè½¬æ¢æˆä¸€ä¸ª64ä½çš„å­—èŠ‚ï¼Œæš‚ä¸”ç§°ä¹‹ä¸ºç‰¹å¾å­—ï¼Œç„¶ååˆ¤æ–­é‡å¤åªéœ€è¦åˆ¤æ–­ä»–ä»¬çš„ç‰¹å¾å­—çš„è·ç¦»æ˜¯ä¸æ˜¯&lt;nï¼ˆæ ¹æ®ç»éªŒè¿™ä¸ªnä¸€èˆ¬å–å€¼ä¸º3ï¼‰ï¼Œå°±å¯ä»¥åˆ¤æ–­ä¸¤ä¸ªæ–‡æ¡£æ˜¯å¦ç›¸ä¼¼ã€‚ ç®—æ³•è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š 1ï¼Œå¯¹æ–‡æœ¬åˆ†è¯ï¼Œå¾—åˆ°Nç»´ç‰¹å¾å‘é‡ï¼ˆé»˜è®¤ä¸º64ç»´ï¼‰ 2ï¼Œä¸ºåˆ†è¯è®¾ç½®æƒé‡ï¼ˆtf-idfï¼‰ 3ï¼Œä¸ºç‰¹å¾å‘é‡è®¡ç®—å“ˆå¸Œ 4ï¼Œå¯¹æ‰€æœ‰ç‰¹å¾å‘é‡åŠ æƒï¼Œç´¯åŠ ï¼ˆç›®å‰ä»…è¿›è¡ŒéåŠ æƒç´¯åŠ ï¼‰ 5ï¼Œå¯¹ç´¯åŠ ç»“æœï¼Œå¤§äºé›¶ç½®ä¸€ï¼Œå°äºé›¶ç½®é›¶ 6ï¼Œå¾—åˆ°æ–‡æœ¬æŒ‡çº¹ï¼ˆfingerprintï¼‰ å…·ä½“æµç¨‹å®ç° simhashçš„ç®—æ³•å…·ä½“åˆ†ä¸º5ä¸ªæ­¥éª¤ï¼šåˆ†è¯ã€hashã€åŠ æƒã€åˆå¹¶ã€é™ç»´ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š åˆ†è¯ ç»™å®šä¸€æ®µè¯­å¥æˆ–è€…ä¸€æ®µæ–‡æœ¬ï¼Œè¿›è¡Œåˆ†è¯ï¼Œå¾—åˆ°æœ‰æ•ˆçš„ç‰¹å¾å‘é‡ï¼Œç„¶åä¸ºæ¯ä¸€ä¸ªç‰¹å¾å‘é‡è®¾ç½®ä¸€ä¸ª5ä¸ªçº§åˆ«ï¼ˆ1â€”5ï¼‰æƒå€¼ã€‚ä¾‹å¦‚ç»™å®šä¸€æ®µè¯­å¥ï¼šâ€œç”Ÿæ´»æœ¬æ²¡æœ‰è·¯ï¼Œèµ°çš„äººå¤šäº†å°±æˆäº†è·¯ï¼Œè¦ç›¸ä¿¡é˜³å…‰æ€»åœ¨é£é›¨åâ€ï¼Œåˆ†è¯åç»“æœä¸ºï¼šç”Ÿæ´» æ²¡æœ‰ æˆäº† ç›¸ä¿¡ é˜³å…‰ é£é›¨ï¼Œç„¶åä¸ºæ¯ä¸ªç‰¹å¾å‘é‡èµ‹äºˆæƒå€¼ï¼šç”Ÿæ´»(5) æ²¡æœ‰(2) æˆäº†(1) ç›¸ä¿¡(2) é˜³å…‰(3) é£é›¨(2)ï¼Œå…¶ä¸­æ‹¬å·é‡Œçš„æ•°å­—ä»£è¡¨è¿™ä¸ªå•è¯åœ¨æ•´æ¡è¯­å¥ä¸­çš„é‡è¦ç¨‹åº¦ï¼Œæ•°å­—è¶Šå¤§ä»£è¡¨è¶Šé‡è¦ã€‚ hash é€šè¿‡hashå‡½æ•°è®¡ç®—å„ä¸ªç‰¹å¾å‘é‡çš„hashå€¼ï¼Œhashå€¼ä¸ºäºŒè¿›åˆ¶æ•°01ç»„æˆçš„n-bitç­¾åã€‚æ¯”å¦‚â€œç”Ÿæ´»â€çš„hashå€¼Hash(ç”Ÿæ´»)ä¸º110101ï¼Œâ€œæ²¡æœ‰â€çš„hashå€¼Hash(æ²¡æœ‰)ä¸ºâ€œ101001â€ã€‚å°±è¿™æ ·ï¼Œå­—ç¬¦ä¸²å°±å˜æˆäº†ä¸€ç³»åˆ—æ•°å­—ã€‚ åŠ æƒ åœ¨hashå€¼çš„åŸºç¡€ä¸Šï¼Œç»™æ‰€æœ‰ç‰¹å¾å‘é‡è¿›è¡ŒåŠ æƒï¼Œå³W = Hash * weightï¼Œä¸”é‡åˆ°1åˆ™hashå€¼å’Œæƒå€¼æ­£ç›¸ä¹˜ï¼Œé‡åˆ°0åˆ™hashå€¼å’Œæƒå€¼è´Ÿç›¸ä¹˜ã€‚ä¾‹å¦‚ç»™â€œç”Ÿæ´»â€çš„hashå€¼â€œ110101â€åŠ æƒå¾—åˆ°ï¼šW(ç”Ÿæ´») = 110101 5 = 5 5 -5 5 -5 5ï¼Œç»™â€œæ²¡æœ‰â€çš„hashå€¼â€œ101001â€åŠ æƒå¾—åˆ°ï¼šW(æ²¡æœ‰)=101001 2 = 2 -2 2 -2 -2 2ï¼Œå…¶ä½™ç‰¹å¾å‘é‡ç±»ä¼¼æ­¤èˆ¬æ“ä½œã€‚ åˆå¹¶ å°†ä¸Šè¿°å„ä¸ªç‰¹å¾å‘é‡çš„åŠ æƒç»“æœç´¯åŠ ï¼Œå˜æˆåªæœ‰ä¸€ä¸ªåºåˆ—ä¸²ã€‚æ‹¿å‰ä¸¤ä¸ªç‰¹å¾å‘é‡ä¸¾ä¾‹ï¼Œä¾‹å¦‚â€œç”Ÿæ´»â€çš„â€œ5 5 -5 5 -5 5â€å’Œâ€œæ²¡æœ‰â€çš„â€œ2 -2 2 -2 -2 2â€è¿›è¡Œç´¯åŠ ï¼Œå¾—åˆ°â€œ5+2 5-2 -5+2 5-2 -5-2 5+2â€ï¼Œå¾—åˆ°â€œ7 3 -3 3 -7 7â€ã€‚ é™ç»´ å¯¹äºn-bitç­¾åçš„ç´¯åŠ ç»“æœï¼Œå¦‚æœå¤§äº0åˆ™ç½®1ï¼Œå¦åˆ™ç½®0ï¼Œä»è€Œå¾—åˆ°è¯¥è¯­å¥çš„simhashå€¼ï¼Œæœ€åæˆ‘ä»¬ä¾¿å¯ä»¥æ ¹æ®ä¸åŒè¯­å¥simhashçš„æµ·æ˜è·ç¦»æ¥åˆ¤æ–­å®ƒä»¬çš„ç›¸ä¼¼åº¦ã€‚ä¾‹å¦‚æŠŠä¸Šé¢è®¡ç®—å‡ºæ¥çš„â€œ9 -9 1 -1 1 9â€é™ç»´ï¼ˆæŸä½å¤§äº0è®°ä¸º1ï¼Œå°äº0è®°ä¸º0ï¼‰ï¼Œå¾—åˆ°çš„01ä¸²ä¸ºï¼šâ€œ1 1 0 1 0 1â€ï¼Œä»è€Œå½¢æˆå®ƒä»¬çš„simhashç­¾åã€‚ æ•´ä¸ªè¿‡ç¨‹çš„æµç¨‹å›¾ä¸ºï¼š 5ã€simhashçš„ç­¾åè·ç¦»è®¡ç®—&ensp;&ensp;&ensp;&ensp;æˆ‘ä»¬æŠŠåº“é‡Œçš„æ–‡æœ¬éƒ½è½¬æ¢ä¸ºsimhashç­¾åï¼Œå¹¶è½¬æ¢ä¸ºlongç±»å‹å­˜å‚¨ï¼Œç©ºé—´å¤§å¤§å‡å°‘ã€‚ç°åœ¨æˆ‘ä»¬è™½ç„¶è§£å†³äº†ç©ºé—´ï¼Œä½†æ˜¯å¦‚ä½•è®¡ç®—ä¸¤ä¸ªsimhashçš„ç›¸ä¼¼åº¦å‘¢ï¼Ÿéš¾é“æ˜¯æ¯”è¾ƒä¸¤ä¸ªsimhashçš„01æœ‰å¤šå°‘ä¸ªä¸åŒå—ï¼Ÿå¯¹çš„ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬é€šè¿‡æµ·æ˜è·ç¦»ï¼ˆHamming distanceï¼‰å°±å¯ä»¥è®¡ç®—å‡ºä¸¤ä¸ªsimhashåˆ°åº•ç›¸ä¼¼ä¸ç›¸ä¼¼ã€‚ä¸¤ä¸ªsimhashå¯¹åº”äºŒè¿›åˆ¶ï¼ˆ01ä¸²ï¼‰å–å€¼ä¸åŒçš„æ•°é‡ç§°ä¸ºè¿™ä¸¤ä¸ªsimhashçš„æµ·æ˜è·ç¦»ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š 10101 å’Œ 00110 ä»ç¬¬ä¸€ä½å¼€å§‹ä¾æ¬¡æœ‰ç¬¬ä¸€ä½ã€ç¬¬å››ã€ç¬¬äº”ä½ä¸åŒï¼Œåˆ™æµ·æ˜è·ç¦»ä¸º3ã€‚å¯¹äºäºŒè¿›åˆ¶å­—ç¬¦ä¸²çš„aå’Œbï¼Œæµ·æ˜è·ç¦»ä¸ºç­‰äºåœ¨a XOR bè¿ç®—ç»“æœä¸­1çš„ä¸ªæ•°ï¼ˆæ™®éç®—æ³•ï¼‰ã€‚ &ensp;&ensp;&ensp;&ensp;æˆ‘ä»¬å¯ä»¥æŠŠ 64 ä½çš„äºŒè¿›åˆ¶simhashç­¾åå‡åˆ†æˆ4å—ï¼Œæ¯å—16ä½ã€‚æ ¹æ®é¸½å·¢åŸç†ï¼ˆä¹Ÿç§°æŠ½å±‰åŸç†ï¼‰ï¼Œå¦‚æœä¸¤ä¸ªç­¾åçš„æµ·æ˜è·ç¦»åœ¨ 3 ä»¥å†…ï¼Œå®ƒä»¬å¿…æœ‰ä¸€å—å®Œå…¨ç›¸åŒã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 6ã€simhashçš„å­˜å‚¨å’ŒæŸ¥æ‰¾ æˆ‘ä»¬éœ€è¦å°†64ä½simhashå‡åˆ†ä¸º4ä»½ï¼Œç„¶åæ¯ä»½ä½œä¸ºkeyå­˜å‚¨åˆ°redis é‡‡ç”¨ç²¾ç¡®åŒ¹é…çš„æ–¹å¼æŸ¥æ‰¾å‰16ä½ æ‰¾åˆ°åˆ™æ‹¿å‡ºæ¥è®¡ç®—ä¸è¢«æ¯”è¾ƒçš„simahshè·ç¦»ï¼Œå°äº3åˆ™åˆ¤æ–­ä¸ºç›¸ä¼¼ï¼ˆå½“ç„¶å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œè¿™ä¸ªå€¼å¯ä»¥è°ƒæ•´ï¼‰ å¦‚æœæ ·æœ¬åº“ä¸­å­˜æœ‰2^34ï¼ˆå·®ä¸å¤š10äº¿ï¼‰çš„å“ˆå¸ŒæŒ‡çº¹ï¼Œåˆ™æ¯ä¸ªtableè¿”å›2^(34-16)=262144ä¸ªå€™é€‰ç»“æœï¼Œå¤§å¤§å‡å°‘äº†æµ·æ˜è·ç¦»çš„è®¡ç®—æˆæœ¬ 7ã€èŠèŠJaccardç›¸ä¼¼åº¦ä¸æ±‰æ˜è·ç¦»7.1 Jaccardç›¸ä¼¼åº¦&ensp;&ensp;&ensp;&ensp; Jaccard ç³»æ•°ï¼Œåˆå«Jaccardç›¸ä¼¼æ€§ç³»æ•°ï¼Œç”¨æ¥æ¯”è¾ƒæ ·æœ¬é›†ä¸­çš„ç›¸ä¼¼æ€§å’Œåˆ†æ•£æ€§çš„ä¸€ä¸ªæ¦‚ç‡ã€‚å…¬å¼ï¼š ç»™å®šä¸¤ä¸ªé›†åˆA,B jaccard ç³»æ•°å®šä¹‰ä¸ºAä¸Bäº¤é›†çš„å¤§å°ä¸å¹¶é›†å¤§å°çš„æ¯”å€¼ï¼Œjaccardå€¼è¶Šå¤§è¯´æ˜ç›¸ä¼¼åº¦è¶Šé«˜ 7.2 æ±‰æ˜è·ç¦»&ensp;&ensp;&ensp;&ensp;åœ¨ä¿¡æ¯ç†è®ºä¸­ï¼ŒHamming Distance è¡¨ç¤ºä¸¤ä¸ªç­‰é•¿å­—ç¬¦ä¸²åœ¨å¯¹åº”ä½ç½®ä¸Šä¸åŒå­—ç¬¦çš„æ•°ç›®ï¼Œæˆ‘ä»¬ä»¥d(x, y)è¡¨ç¤ºå­—ç¬¦ä¸²xå’Œyä¹‹é—´çš„æ±‰æ˜è·ç¦»ã€‚ä»å¦å¤–ä¸€ä¸ªæ–¹é¢çœ‹ï¼Œæ±‰æ˜è·ç¦»åº¦é‡äº†é€šè¿‡æ›¿æ¢å­—ç¬¦çš„æ–¹å¼å°†å­—ç¬¦ä¸²xå˜æˆyæ‰€éœ€è¦çš„æœ€å°çš„æ›¿æ¢æ¬¡æ•°ã€‚ 12345ä¸¾ä¾‹è¯´æ˜ä»¥ä¸‹å­—ç¬¦ä¸²é—´çš„æ±‰æ˜è·ç¦»ä¸ºï¼š&quot;karolin&quot; and &quot;kathrin&quot; is 3.&quot;karolin&quot; and &quot;kerstin&quot; is 3.1011101 and 1001001 is 2.2173896 and 2233796 is 3. 8ã€ã€å®æˆ˜ã€‘æ–°é—»æ–‡æœ¬å»é‡æœåŠ¡è¯¦ç»†æµç¨‹&ensp;&ensp;&ensp;&ensp;ä¸Šé¢é™†é™†ç»­ç»­è®²äº†è¿™ä¹ˆå¤šç†è®ºçŸ¥è¯†æƒ³å¿…å¤§å®¶ä¹Ÿæ˜¯ä¸€å¤´é›¾æ°´ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡å®æˆ˜æ¥è®²è¿°æ•´ä½“æµç¨‹ã€‚ &ensp;&ensp;&ensp;&ensp;æœ¬æ–‡å°†æ–‡æœ¬æ’é‡åšæˆäº†ä¸€ä¸ªæ¥å£ï¼Œé¦–å…ˆç»™å»é‡æ¥å£ä¼ ä¸€äº›å¿…è¦çš„å‚æ•°ï¼Œé’ˆå¯¹æ–°é—»æ–‡æœ¬ä¸ºä¾‹ï¼ˆurl:é“¾æ¥ title:æ–‡æœ¬æ ‡é¢˜ content:å†…å®¹ï¼‰ã€‚ä¾æ¬¡æ˜¯è¿›è¡Œurlæ’é‡ã€titleæ’é‡ã€contentæ’é‡ï¼Œå¦‚æœä¸‰ç§éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™å»ºç«‹urlã€titleã€contentç´¢å¼•å­˜å‚¨åˆ°redisã€‚å…·ä½“æµç¨‹å›¾å¦‚ä¸‹ï¼š 8.1ã€URLæ’é‡ å»ºç«‹URLç´¢å¼•ï¼š 12key: url_index_name+&quot;_&quot;+urlMD5ã€‚url_index_nameä¸ºç´¢å¼•åå­—ï¼ŒurlMD5è¡¨ç¤ºurlçš„MD5å€¼value: docId+&quot;\\t&quot;+url+&quot;\\t&quot;+storageTimeã€‚ docIdä¸ºæ–°é—»çš„äº‹ä»¶idï¼Œurlè¡¨ç¤ºæ–°é—»é“¾æ¥ï¼ŒstorageTimeè¡¨ç¤ºå­˜å…¥redisçš„æ—¶é—´æˆ³ æ ¹æ®urlMD5ä»redisæŸ¥æ‰¾æ•°æ®ï¼Œæ‰¾åˆ°åˆ™æ’é‡æˆåŠŸè¿”å›docIdï¼Œæ²¡æœ‰æ‰¾åˆ°åˆ™æ’é‡å¤±è´¥ã€‚ 8.2ã€Titleæ’é‡ å»ºç«‹Titleç´¢å¼•ï¼š 12key: title_index_name+&quot;_&quot;+titleMD5ã€‚title_index_nameä¸ºç´¢å¼•åå­—ï¼ŒtitleMD5è¡¨ç¤ºtitleçš„MD5å€¼value: docId+&quot;\\t&quot;+title+&quot;\\t&quot;+url+&quot;\\t&quot;+storageTimeã€‚ docIdä¸ºæ–°é—»çš„äº‹ä»¶idï¼Œtitleä¸ºæ–°é—»æ ‡é¢˜ï¼Œurlè¡¨ç¤ºæ–°é—»é“¾æ¥ï¼ŒstorageTimeè¡¨ç¤ºå­˜å…¥redisçš„æ—¶é—´æˆ³ æ ¹æ®titleMD5ä»redisæŸ¥æ‰¾æ•°æ®ï¼Œæ‰¾åˆ°åˆ™æ’é‡æˆåŠŸè¿”å›docIdï¼Œæ²¡æœ‰æ‰¾åˆ°åˆ™æ’é‡å¤±è´¥ã€‚ 8.3ã€Contentæ’é‡ å»ºç«‹Contentç´¢å¼•ï¼š 1234å…ˆå°†64ä½simhashå€¼å‡åˆ†ä¸º4ä»½ï¼šsimHashFragment1ã€simHashFragment2ã€simHashFragment3ã€simHashFragment4key: content_index_name+&quot;_&quot;+simHashFragmentã€‚content_index_nameä¸ºç´¢å¼•åå­—ï¼ŒsimHashFragmentè¡¨ç¤ºå…¶ä¸­ä¸€æ®µsimhashå€¼ï¼ˆ16ä½ï¼‰value: docId+&quot;\\t&quot;+title+&quot;\\t&quot;+simhash+&quot;\\t&quot;+url+&quot;\\t&quot;+storageTimeã€‚ docIdä¸ºæ–°é—»çš„äº‹ä»¶idï¼Œtitleä¸ºæ–°é—»æ ‡é¢˜ï¼Œurlè¡¨ç¤ºæ–°é—»é“¾æ¥ï¼ŒstorageTimeè¡¨ç¤ºå­˜å…¥redisçš„æ—¶é—´æˆ³ ç„¶åå°†è¿™4ä»½ç´¢å¼•å­˜å‚¨åˆ°redis(LIST) æ ¹æ®simHashFragmentç´¢å¼•ä»redisé‡Œé¢æŸ¥æ‰¾ï¼ˆ4ä»½simhashç´¢å¼•éƒ½å¾—ä¸€èµ·å¬å›ï¼‰ å°†å¬å›çš„å€¼ä¾æ¬¡ä¸å¸¦æ’é‡çš„æ–‡æœ¬æ¯”å¯¹ hanmingDistance&lt;=H å¹¶ä¸” jarccardSimilary&gt;=J å¬å›(ä¸€èˆ¬è®¾ç½®H=10,J=0.7 å…·ä½“æƒ…å†µå…·ä½“åˆ†æ) æ³¨ï¼šä¸‰å¤©å†…æ–°é—»åšæ³• hanmingDistance&lt;=3 å¹¶ä¸” jarccardSimilary&gt;=0.7 æ³¨ï¼šä¸‰å¤©å¤–æ–°é—»åšæ³• å°†å¬å›çš„æ–°é—»åšrankï¼ˆè¿™é‡Œä¸ç»†è®²ï¼Œæ–¹æ³•å¾ˆå¤šï¼‰ï¼ŒTOP1ä½œä¸ºæ’é‡çš„æ–°é—» 9ã€æ€»ç»“&ensp;&ensp;&ensp;&ensp;ç°å¦‚ä»Šæ˜¯ä¸€ä¸ªä¿¡æ¯è¿‡è½½çš„æ—¶ä»£ï¼Œé«˜æ•ˆçš„ä»æµ·é‡æ–‡æœ¬é‡Œé¢å¿«é€Ÿæ‰¾åˆ°ç›¸ä¼¼çš„æ–‡æœ¬æ˜¯ä¸€ä¸ªéœ€è¦è§£å†³çš„ä¸€ä¸ªç—›ç‚¹ï¼Œsimhashçš„å­˜åœ¨å°±å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ &ensp;&ensp;&ensp;&ensp;ç”±äºsimhashæ˜¯å±€éƒ¨æ•æ„Ÿçš„hashï¼Œå…¶å¯èƒ½ä¸é€‚åˆåšè¿™ç§çŸ­æ ‡é¢˜çš„é‡å¤åº¦åˆ¤æ–­ï¼Œä¼šå­˜åœ¨ä¸€å®šçš„è¯¯å·®ï¼Œæ–‡æœ¬è¶Šé•¿åˆ¤æ–­çš„å‡†ç¡®ç‡è¶Šé«˜ã€‚ å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œè®°å½•ç‚¹æ»´ï¼","categories":[{"name":"java","slug":"java","permalink":"http://yoursite.com/categories/java/"}],"tags":[{"name":"æ–‡æœ¬å»é‡","slug":"æ–‡æœ¬å»é‡","permalink":"http://yoursite.com/tags/æ–‡æœ¬å»é‡/"},{"name":"simhash","slug":"simhash","permalink":"http://yoursite.com/tags/simhash/"}],"keywords":[{"name":"java","slug":"java","permalink":"http://yoursite.com/categories/java/"}]},{"title":"markdownåŸºæœ¬è¯­æ³•","slug":"markdownåŸºæœ¬è¯­æ³•","date":"2019-01-05T13:31:07.000Z","updated":"2019-01-08T10:05:38.100Z","comments":true,"path":"2019/01/05/markdownåŸºæœ¬è¯­æ³•/","link":"","permalink":"http://yoursite.com/2019/01/05/markdownåŸºæœ¬è¯­æ³•/","excerpt":"","text":"&ensp;&ensp;&ensp;&ensp; markdownæ˜¯ä¸€ç§çº¯æ–‡æœ¬æ ¼å¼çš„æ ‡è®°è¯­è¨€ã€‚é€šè¿‡ç®€å•çš„æ ‡è®°è¯­æ³•ï¼Œå®ƒå¯ä»¥ä½¿æ™®é€šæ–‡æœ¬å†…å®¹å…·æœ‰ä¸€å®šçš„æ ¼å¼ã€‚ ä¼˜ç‚¹ å› ä¸ºæ˜¯çº¯æ–‡æœ¬ï¼Œæ‰€ä»¥åªè¦æ”¯æŒmarkdownçš„åœ°æ–¹éƒ½èƒ½è·å¾—ä¸€æ ·çš„ç¼–è¾‘æ•ˆæœï¼Œå¯ä»¥è®©ä½œè€…æ‘†è„±æ’ç‰ˆçš„å›°æ‰°ï¼Œä¸“å¿ƒå†™ä½œã€‚ æ“ä½œç®€å•ã€‚æ¯”å¦‚:WYSIWYGç¼–è¾‘æ—¶æ ‡è®°ä¸ªæ ‡é¢˜ï¼Œå…ˆé€‰ä¸­å†…å®¹ï¼Œå†ç‚¹å‡»å¯¼èˆªæ çš„æ ‡é¢˜æŒ‰é’®ï¼Œé€‰æ‹©å‡ çº§æ ‡é¢˜ã€‚è¦ä¸‰ä¸ªæ­¥éª¤ã€‚è€Œmarkdownåªéœ€è¦åœ¨æ ‡é¢˜å†…å®¹å‰åŠ #å³å¯ ç¼ºç‚¹ éœ€è¦è®°ä¸€äº›è¯­æ³•ï¼ˆå½“ç„¶ï¼Œæ˜¯å¾ˆç®€å•ã€‚äº”åˆ†é’Ÿå­¦ä¼šï¼‰ã€‚ æœ‰äº›å¹³å°ä¸æ”¯æŒmarkdownç¼–è¾‘æ¨¡å¼ã€‚ ä¸€ã€æ ‡é¢˜&ensp;&ensp;&ensp;&ensp; åœ¨æƒ³è¦è®¾ç½®ä¸ºæ ‡é¢˜çš„æ–‡å­—å‰é¢åŠ #æ¥è¡¨ç¤ºä¸€ä¸ª#æ˜¯ä¸€çº§æ ‡é¢˜ï¼ŒäºŒä¸ª#æ˜¯äºŒçº§æ ‡é¢˜ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ”¯æŒå…­çº§æ ‡é¢˜ã€‚ ç¤ºä¾‹ï¼š 123456# è¿™æ˜¯ä¸€çº§æ ‡é¢˜## è¿™æ˜¯äºŒçº§æ ‡é¢˜### è¿™æ˜¯ä¸‰çº§æ ‡é¢˜#### è¿™æ˜¯å››çº§æ ‡é¢˜##### è¿™æ˜¯äº”çº§æ ‡é¢˜###### è¿™æ˜¯å…­çº§æ ‡é¢˜ äºŒã€å­—ä½“ åŠ ç²— è¦åŠ ç²—çš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸¤ä¸ª*å·åŒ…èµ·æ¥ æ–œä½“ è¦å€¾æ–œçš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸€ä¸ª*å·åŒ…èµ·æ¥ æ–œä½“åŠ ç²— è¦å€¾æ–œå’ŒåŠ ç²—çš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸‰ä¸ª*å·åŒ…èµ·æ¥ åˆ é™¤çº¿ è¦åŠ åˆ é™¤çº¿çš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸¤ä¸ª~~å·åŒ…èµ·æ¥ ç¤ºä¾‹ï¼š 1234**è¿™æ˜¯åŠ ç²—çš„æ–‡å­—***è¿™æ˜¯å€¾æ–œçš„æ–‡å­—*`***è¿™æ˜¯æ–œä½“åŠ ç²—çš„æ–‡å­—***~~è¿™æ˜¯åŠ åˆ é™¤çº¿çš„æ–‡å­—~~ ä¸‰ã€å¼•ç”¨åœ¨å¼•ç”¨çš„æ–‡å­—å‰åŠ &gt;å³å¯ã€‚ç¤ºä¾‹ï¼š 123&gt;è¿™æ˜¯å¼•ç”¨çš„å†…å®¹&gt;&gt;è¿™æ˜¯å¼•ç”¨çš„å†…å®¹&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;è¿™æ˜¯å¼•ç”¨çš„å†…å®¹ å››ã€åˆ†å‰²çº¿ä¸‰ä¸ªæˆ–è€…ä¸‰ä¸ªä»¥ä¸Šçš„ - æˆ–è€… * éƒ½å¯ä»¥ã€‚ç¤ºä¾‹ï¼š 12345-------******** äº”ã€å›¾ç‰‡è¯­æ³•ï¼š123![å›¾ç‰‡alt](å›¾ç‰‡åœ°å€ &apos;&apos;å›¾ç‰‡title&apos;&apos;)å›¾ç‰‡altå°±æ˜¯æ˜¾ç¤ºåœ¨å›¾ç‰‡ä¸‹é¢çš„æ–‡å­—ï¼Œç›¸å½“äºå¯¹å›¾ç‰‡å†…å®¹çš„è§£é‡Šã€‚å›¾ç‰‡titleæ˜¯å›¾ç‰‡çš„æ ‡é¢˜ï¼Œå½“é¼ æ ‡ç§»åˆ°å›¾ç‰‡ä¸Šæ—¶æ˜¾ç¤ºçš„å†…å®¹ã€‚titleå¯åŠ å¯ä¸åŠ  å…­ã€è¶…é“¾æ¥è¯­æ³•ï¼š12[è¶…é“¾æ¥å](è¶…é“¾æ¥åœ°å€ &quot;è¶…é“¾æ¥title&quot;)titleå¯åŠ å¯ä¸åŠ  ç¤ºä¾‹ï¼š12[æœç‹](http://www.souhu.com)[ç™¾åº¦](http://www.baidu.com) ä¸ƒã€åˆ—è¡¨æ— åºåˆ—è¡¨è¯­æ³•ï¼šæ— åºåˆ—è¡¨ç”¨ - + * ä»»ä½•ä¸€ç§éƒ½å¯ä»¥12345- åˆ—è¡¨å†…å®¹+ åˆ—è¡¨å†…å®¹* åˆ—è¡¨å†…å®¹æ³¨æ„ï¼š- + * è·Ÿå†…å®¹ä¹‹é—´éƒ½è¦æœ‰ä¸€ä¸ªç©ºæ ¼ æœ‰åºåˆ—è¡¨è¯­æ³•ï¼šæ•°å­—åŠ ç‚¹123451.åˆ—è¡¨å†…å®¹2.åˆ—è¡¨å†…å®¹3.åˆ—è¡¨å†…å®¹æ³¨æ„ï¼šåºå·è·Ÿå†…å®¹ä¹‹é—´è¦æœ‰ç©ºæ ¼ åˆ—è¡¨åµŒå¥—ä¸Šä¸€çº§å’Œä¸‹ä¸€çº§ä¹‹é—´æ•²ä¸‰ä¸ªç©ºæ ¼å³å¯ ä¸€çº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ ä¸€çº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ ä¸€çº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ ä¸€çº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ å…«ã€è¡¨æ ¼è¯­æ³•ï¼š1234567891011è¡¨å¤´|è¡¨å¤´|è¡¨å¤´---|:--:|---:å†…å®¹|å†…å®¹|å†…å®¹å†…å®¹|å†…å®¹|å†…å®¹ç¬¬äºŒè¡Œåˆ†å‰²è¡¨å¤´å’Œå†…å®¹ã€‚- æœ‰ä¸€ä¸ªå°±è¡Œï¼Œä¸ºäº†å¯¹é½ï¼Œå¤šåŠ äº†å‡ ä¸ªæ–‡å­—é»˜è®¤å±…å·¦-ä¸¤è¾¹åŠ ï¼šè¡¨ç¤ºæ–‡å­—å±…ä¸­-å³è¾¹åŠ ï¼šè¡¨ç¤ºæ–‡å­—å±…å³æ³¨ï¼šåŸç”Ÿçš„è¯­æ³•ä¸¤è¾¹éƒ½è¦ç”¨ | åŒ…èµ·æ¥ã€‚æ­¤å¤„çœç•¥ ç¤ºä¾‹ï¼š12345| æ°´æœ | ä»·æ ¼ | æ•°é‡ | | -------- | -----: | :----: | | é¦™è•‰ | $1 | 5 | | è‹¹æœ | $1 | 6 | | è‰è“ | $1 | 7 | æ°´æœ ä»·æ ¼ æ•°é‡ é¦™è•‰ $1 5 è‹¹æœ $1 6 è‰è“ $1 7 ä¹ã€ä»£ç è¯­æ³•ï¼šå•è¡Œä»£ç ï¼šä»£ç ä¹‹é—´åˆ†åˆ«ç”¨ä¸€ä¸ªåå¼•å·åŒ…èµ·æ¥1`ä»£ç å†…å®¹` python ä»£ç å—12345a = range(2000)for i in a: if i % 2 == 0: continue print(i + 1) java ä»£ç å—123456789private URLInfo extractURLHost(String url)&#123; URLInfo urlInfo = new URLInfo(); String host = HostDomainExtractKit.extractURLHost(url); String domain = HostDomainExtractKit.getTopLevelDomain(url); urlInfo.setHost(host); urlInfo.setDomain(domain); return urlInfo; &#125; åã€æµç¨‹å›¾ä¸€èˆ¬å†™æ³•ï¼š1234567st=&gt;start: Startop=&gt;operation: My Operationcond=&gt;condition: Yes or No?e=&gt;Endst-&gt;op-&gt;condcond(yes)-&gt;econd(no)-&gt;op æ³¨ï¼šMarkDownæ²¡ æœ‰ç»Ÿä¸€æ ‡å‡†ï¼Œä¸åŒç½‘ç«™å®ç°çš„æ–¹å¼ä¸åŒï¼Œç›®å‰githubä¸Šå†™markdownï¼Œå¹¶æ²¡æœ‰å®ç°æµç¨‹å›¾çš„è¯­æ³•ã€‚","categories":[{"name":"markdown","slug":"markdown","permalink":"http://yoursite.com/categories/markdown/"}],"tags":[{"name":"markdown","slug":"markdown","permalink":"http://yoursite.com/tags/markdown/"}],"keywords":[{"name":"markdown","slug":"markdown","permalink":"http://yoursite.com/categories/markdown/"}]},{"title":"ubuntuä¸‹å®‰è£…PyV8","slug":"pyv8","date":"2019-01-03T15:42:15.000Z","updated":"2019-01-08T10:05:38.093Z","comments":true,"path":"2019/01/03/pyv8/","link":"","permalink":"http://yoursite.com/2019/01/03/pyv8/","excerpt":"","text":"è¿™å‡ å¤©éœ€è¦ä½¿ç”¨PyV8æ¥è¿›è¡Œpythonä¸javascriptçš„äº¤äº’ï¼Œåœ¨ubuntuä¸Šé¢å®‰è£…é‡åˆ°äº†ä¸å°‘çš„å‘ï¼ŒæŠ˜è…¾å‡ å°æ—¶ç»ˆäºæ‰¾åˆ°æ–¹æ³•ã€‚ å®‰è£…ä¾èµ–123$ sudo apt-get install scons$ sudo apt-get install libboost-dev libboost-thread-dev$ sudo apt-get install libboost-system-dev libboost-python-dev å®‰è£…Pyv8&ensp;&ensp;&ensp;&ensp;ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶githubæ‰¾åˆ°é€‚åˆä½ æœºå™¨çš„ç‰ˆæœ¬ä¸‹è½½ã€‚è§£å‹å‡ºæ¥åº”è¯¥æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼šPyV8.py , _PyV8.so,ç„¶åæŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶æ‹·è´åˆ°ä½ çš„pythonç¬¬ä¸‰æ–¹åŒ…çš„ç›®å½•é‡Œé¢å°±å¥½ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯:12$ cd pyv8$ sudo cp * /usr/lib/python2.7/dist-packages/ &ensp;&ensp;&ensp;ç„¶åè¿›å…¥åˆ°pythonç¯å¢ƒæµ‹è¯•å¦‚ä¸‹ä»£ç :123456789101112import PyV8ctxt = PyV8.JSContext()ctxt.enter()func = ctxt.eval(\"\"\"(function()&#123; function hello()&#123; return \"Hello world.\"; &#125; return hello(); &#125;) \"\"\")print func() æ‰§è¡Œè¾“å‡ºHello Worldè¯´æ˜å®‰è£…æˆåŠŸäº†ï¼Œå°±å¯ä»¥æ¨¡æ‹ŸJSä»£ç äº†ã€‚ å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œè®°å½•ç‚¹æ»´ï¼","categories":[{"name":"python","slug":"python","permalink":"http://yoursite.com/categories/python/"}],"tags":[{"name":"pyv8","slug":"pyv8","permalink":"http://yoursite.com/tags/pyv8/"}],"keywords":[{"name":"python","slug":"python","permalink":"http://yoursite.com/categories/python/"}]},{"title":"hexoä¸€ä¸ªé”™è¯¯è§£","slug":"error","date":"2019-01-02T15:42:15.000Z","updated":"2019-01-08T10:05:38.107Z","comments":true,"path":"2019/01/02/error/","link":"","permalink":"http://yoursite.com/2019/01/02/error/","excerpt":"","text":"ä»Šå¤©è¿›å…¥åˆ°åšå®¢ç›®å½•ï¼Œå‘ç°hexoå‘½ä»¤è¡Œç”¨ä¸äº†äº†ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š ERROR Local hexo not found in ~/Downloads/hexo/blog ERROR Try running: â€˜npm install hexo â€“saveâ€™ è§£å†³åŠæ³• rm -rf node_modules npm install ok,è‡³æ­¤hexoå‘½ä»¤å·²ç»å¯ä»¥è¿è¡Œï¼Œé—®é¢˜è§£å†³ï¼ å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œè®°å½•ç‚¹æ»´ï¼","categories":[{"name":"å¸¸è§é”™è¯¯è§£å†³","slug":"å¸¸è§é”™è¯¯è§£å†³","permalink":"http://yoursite.com/categories/å¸¸è§é”™è¯¯è§£å†³/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"http://yoursite.com/tags/hexo/"}],"keywords":[{"name":"å¸¸è§é”™è¯¯è§£å†³","slug":"å¸¸è§é”™è¯¯è§£å†³","permalink":"http://yoursite.com/categories/å¸¸è§é”™è¯¯è§£å†³/"}]},{"title":"smilemilkçš„ç¬¬ä¸€æ¬¡åšå®¢ä¹‹æ—…","slug":"hello-world","date":"2019-01-01T01:42:15.000Z","updated":"2019-01-10T08:56:06.019Z","comments":true,"path":"2019/01/01/hello-world/","link":"","permalink":"http://yoursite.com/2019/01/01/hello-world/","excerpt":"","text":"åœ¨è¿™é‡Œæˆ‘å°†ä¼šå’Œå¤§å®¶åœ¨æ¥ä¸‹æ¥çš„æ—¥å­é‡Œé¢ä¸€èµ·åˆ†äº«è‡ªå·±çš„çˆ¬è™«+æœç´¢+å¤§æ•°æ®æ–¹é¢çš„å·¥ç¨‹ç»éªŒï¼Œ &ensp;&ensp;&ensp;&ensp;æœ¬æ¥2018å¹´å°±æƒ³å†™ç‚¹è‡ªå·±çš„ä¸œè¥¿ä¸€ç›´æ‹–åˆ°2019å¹´ï¼ˆğŸ¤¦æ‚è„¸ã€‚ã€‚ã€‚â™€)ï¼Œä¸»è¦æ˜¯å› ä¸º2018å¹´æ•´ä¸ªåœ¨å¿™å®ä¹ è¿˜æœ‰ç¡•å£«æ¯•ä¸šçš„å„ç§äº‹æƒ…ã€‚è½¬çœ¼å°±åˆ° 2019 å¹´äº†ï¼Œå…¶å®æˆ‘æ²¡æœ‰å†™æ€»ç»“çš„ä¹ æƒ¯ï¼Œç°åœ¨åˆ°å¤´æ¥è¿˜æ˜¯è›®åæ‚”çš„ï¼Œè¯´å®è¯æ€»ç»“å…¶å®è¿˜æ˜¯è›®æœ‰å¿…è¦çš„ï¼Œç°åœ¨å°±è¶ç€è¿™ä¸ªæ—¶é—´æ¥ç«‹ä¸€ä¸‹ 2019 çš„ Flagï¼Œå†ç­‰åˆ° 2020 å¹´ç¿»å‡ºæ¥æ‰“è„¸å§ï¼Œå“ˆå“ˆğŸ˜„ã€‚ 35å²ä¹‹å‰åªåšèƒ½æé«˜è‡ªå·±æŠ€æœ¯æ°´å¹³çš„äº‹æƒ…ï¼Œèƒ½å¤Ÿæˆä¸ºå…¬è®¤çš„æŸä¸€ä¸ªæŠ€æœ¯é¢†åŸŸçš„ä¸“å®¶ã€‚ä¸éšæ³¢é€æµï¼Œè¦ç‹¬æ ‘ä¸€å¸œã€‚ ä¼˜è´¨åšå®¢ï¼š zsythink å´”åº†æ‰ rowkey å¾åˆ˜æ ¹ å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œæ¥ä¸‹æ¥æˆ‘çš„åšå®¢å°†ä¼šé™†ç»­æ›´æ–°ï¼Œåšå®¢è¿˜åœ¨æ–½å·¥ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼ï¼","categories":[{"name":"about me","slug":"about-me","permalink":"http://yoursite.com/categories/about-me/"}],"tags":[],"keywords":[{"name":"about me","slug":"about-me","permalink":"http://yoursite.com/categories/about-me/"}]}]}
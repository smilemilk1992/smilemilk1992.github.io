<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="good good learn, day day up!"><title>【深度好文】simhash文本去重流程 | smilemilk</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【深度好文】simhash文本去重流程</h1><a id="logo" href="/.">smilemilk</a><p class="description">大数据 · Python · 技术博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">【深度好文】simhash文本去重流程</h1><div class="post-meta"><a href="/2018/11/15/simhash/#comments" class="comment-count"></a><p><span class="date">Nov 15, 2018</span><span><a href="/categories/simhash/" class="category">simhash</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p><strong> &ensp;&ensp;&ensp;&ensp;本人目前就职于某厂新闻客户端，对于新闻客户端而言，推荐的每一刷的新闻都必须是不同的新闻，这就需要对新闻文本进行排重。传统的去重一般是对文章的url链接进行排重，但是对于抓取的网页来说，各大平台的新闻可能存在重复，对于只通过文章url进行排重是不靠谱的，为了解决这个痛点于是就提出了用simhash来解决这个难题。 </strong></p>
<hr>
<h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h1><p>&ensp;&ensp;&ensp;&ensp; 传统的Hash算法只负责将原始内容尽量均匀随机地映射为一个签名值，原理上仅相当于伪随机数产生算法。即便是两个原始内容只相差一个字节，所产生的签名也很可能差别很大，所以传统的Hash是无法在签名的维度上来衡量原内容的相似度。而SimHash本身属于一种<a href="https://www.cnblogs.com/maybe2030/p/4953039.html" target="_blank" rel="noopener">局部敏感hash</a>，其主要思想是降维，将高维的特征向量转化成一个f位的指纹（fingerprint），通过算出两个指纹的海明距离（hamming distince）来确定两篇文章的相似度，海明距离越小，相似度越低（根据 Detecting Near-Duplicates for Web Crawling 论文中所说），一般海明距离为3就代表两篇文章相同。<br>&ensp;&ensp;&ensp;&ensp; simhash也有其局限性，在处理小于500字的短文本时，simhash的表现并不是很好，所以在使用simhash前一定要注意这个细节。</p>
<h1 id="2-背景"><a href="#2-背景" class="headerlink" title="2.背景"></a>2.背景</h1><p><strong> 如何设计一个比较两篇文章相似度的算法？可能你会回答几个比较传统点的思路: </strong></p>
<ul>
<li>一种方案是先将两篇文章分别进行分词，得到一系列特征向量，然后计算特征向量之间的距离（可以计算它们之间的<a href="https://baike.baidu.com/item/%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E5%BA%A6%E9%87%8F/1274107?fr=aladdin" target="_blank" rel="noopener">欧氏距离</a>、<a href="https://baike.baidu.com/item/%E6%B5%B7%E6%98%8E%E8%B7%9D%E7%A6%BB" target="_blank" rel="noopener">海明距离</a>或者<a href="https://baike.baidu.com/item/%E4%BD%99%E5%BC%A6%E7%9B%B8%E4%BC%BC%E5%BA%A6" target="_blank" rel="noopener">夹角余弦</a>等等），从而通过距离的大小来判断两篇文章的相似度。</li>
<li>另外一种是传统hash，我们考虑为每一个web文档通过hash的方式生成一个指纹（finger print）。</li>
</ul>
<p><strong> 下面我们来分析一下这两种方法: </strong></p>
<ul>
<li>采取第一种方法，若是只比较两篇文章的相似性还好，但如果是海量数据呢，有着数以百万甚至亿万的网页，要求你计算这些网页的相似度。你还会去计算任意两个网页之间的距离或夹角余弦么？那样做的话时间复杂度，空间复杂度可想而知。</li>
<li>而第二种方案中所说的传统加密方式md5，其设计的目的是为了让整个分布尽可能地均匀，但如果输入内容一旦出现哪怕轻微的变化，hash值就会发生很大的变化。</li>
</ul>
<h1 id="3-simhash与hash算法的区别"><a href="#3-simhash与hash算法的区别" class="headerlink" title="3.simhash与hash算法的区别"></a>3.simhash与hash算法的区别</h1><p>&ensp;&ensp;&ensp;&ensp; 传统Hash算法只负责将原始内容尽量均匀随机地映射为一个签名值，原理上仅相当于伪随机数产生算法。传统hash算法产生的两个签名，如果不相等，除了说明原始内容不相等外，不再提供任何信息，因为即使原始内容只相差一个字节，所产生的签名也很可能差别很大，所以传统Hash是无法在签名的维度上来衡量原内容的相似度。而SimHash本身属于一种局部敏感哈希算法，它产生的hash签名在一定程度上可以表征原内容的相似度。<br>&ensp;&ensp;&ensp;&ensp; 我们主要解决的是文本相似度计算，要比较的是两个文章是否相似，当然我们降维生成了hash签名也是用于这个目的。看到这里，估计大家就明白了，即使把文章中的字符串变成 01 串，我们使用的simhash算法也还是可以用于计算相似度，而传统的hash却不行。我们可以来做个测试，两个相差只有一个字符的文本串，“你妈妈喊你回家吃饭哦，回家罗回家罗” 和 “你妈妈叫你回家吃饭啦，回家罗回家罗”。</p>
<h1 id="4-simhash原理"><a href="#4-simhash原理" class="headerlink" title="4.simhash原理"></a>4.simhash原理</h1><blockquote>
<p>simhash是google用来处理海量文本去重的算法。 google出品，你懂的。 simhash最牛逼的一点就是将一个文档，最后转换成一个64位的字节，暂且称之为特征字，然后判断重复只需要判断他们的特征字的距离是不是&lt;n（根据经验这个n一般取值为3），就可以判断两个文档是否相似。</p>
</blockquote>
<p><strong> 算法过程大致如下：</strong></p>
<ul>
<li>1，对文本分词，得到N维特征向量（默认为64维）</li>
<li>2，为分词设置权重（tf-idf）</li>
<li>3，为特征向量计算哈希</li>
<li>4，对所有特征向量加权，累加（目前仅进行非加权累加）</li>
<li>5，对累加结果，大于零置一，小于零置零</li>
<li>6，得到文本指纹（fingerprint）</li>
</ul>
<p><strong> 具体流程实现 </strong><br>图片<br><img src="/img/simhash/simhash1.jpeg" alt="simhash1"><br><img src="/img/simhash/simhash2.jpeg" alt="simhash2"><br><img src="/img/simhash/simhash3.jpeg" alt="simhash3"></p>
<h1 id="5-距离计算"><a href="#5-距离计算" class="headerlink" title="5.距离计算"></a>5.距离计算</h1><hr>
<p>好记性不如烂笔头，记录点滴！</p>
<hr>
</div><div class="tags"><a href="/tags/文本去重/">文本去重</a></div><div class="post-share"></div><div class="post-nav"><a href="/2018/11/18/markdown基本语法/" class="pre">markdown基本语法</a><a href="/2018/07/15/error/" class="next">hexo一个错误解</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zMjA0NS84NjA5"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-简介"><span class="toc-text">1.简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-背景"><span class="toc-text">2.背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-simhash与hash算法的区别"><span class="toc-text">3.simhash与hash算法的区别</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-simhash原理"><span class="toc-text">4.simhash原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-距离计算"><span class="toc-text">5.距离计算</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/18/markdown基本语法/">markdown基本语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/15/simhash/">【深度好文】simhash文本去重流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/15/error/">hexo一个错误解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/20/pyv8/">ubuntu下安装PyV8</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/02/hello-world/">smilemilk的第一次博客之旅</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/about-me/">about me</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/simhash/">simhash</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/常见错误解决/">常见错误解决</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/简介/" style="font-size: 15px;">简介</a> <a href="/tags/大学/" style="font-size: 15px;">大学</a> <a href="/tags/爱好/" style="font-size: 15px;">爱好</a> <a href="/tags/文本去重/" style="font-size: 15px;">文本去重</a> <a href="/tags/pyv8/" style="font-size: 15px;">pyv8</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-weibo"> 新浪微博</i></div><iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=0&uid=5535584208&verifier=121d2113&dpc=1"></iframe></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><!--if theme.baidusitemap--><!--  a(href=config.root+"baidusitemap.xml")= __("baidusitemap")--><!--  |  |--><!--if theme.feed--><!--  a(href=config.root+"atom.xml")= __("rss")--><a href="/about/">关于 |  </a><!--a(href=config.root+"about/")= __("about")--><span>联系博主：<a href="mailto:jamesch1992@sina.com" target="_blank" class="fa fa-email"></a><a href="https://weibo.com/5535584208/profile?topnav=1&amp;wvr=6&amp;is_all=1" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/smilemilk1992" target="_blank" class="fa fa-github"></a></span></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Chen Hao.</a></span><!--span  Theme by--><!--  a(rel='nofollow', target='_blank', href='https://github.com/chaooo/hexo-theme-BlueLake')  BlueLake.--><!--if theme.busuanzi == true--><!--  span  Count by--><!--    a(href="http://busuanzi.ibruce.info/")  busuanzi.--><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script></body></html>